{"version":3,"sources":["studio-state.js","ui/about.js","ui/header.js","ui/studio/steps.js","ui/studio/capturer.js","ui/studio/keyboard-shortcuts/globalKeys.js","ui/studio/elements.js","ui/notification.js","ui/studio/audio-setup/preview-audio.js","ui/studio/audio-setup/index.js","ui/elements.js","ui/studio/save-creation/recording-preview.js","ui/studio/save-creation/index.js","Tooltip.js","ui/studio/video-setup/prefs.js","ui/studio/video-setup/preview.js","ui/studio/video-setup/index.js","ui/studio/recording/media-devices.js","recorder.js","ui/studio/recording/recording-buttons.js","ui/studio/recording/clock.js","ui/studio/recording/recording-controls.js","ui/studio/recording/index.js","ui/studio/review/cut-out-icon.svg","ui/studio/review/cut-here-icon.svg","ui/studio/review/index.js","ui/studio/page.js","languages.js","ui/settings/elements.js","ui/settings/language.js","ui/settings/opencast.js","ui/settings/colorMode.js","ui/settings/page.js","ui/warnings.js","ui/studio/keyboard-shortcuts/shortcuts.js","App.js"],"names":["AUDIO_SOURCE_MICROPHONE","AUDIO_SOURCE_NONE","VIDEO_SOURCE_BOTH","VIDEO_SOURCE_DISPLAY","VIDEO_SOURCE_USER","VIDEO_SOURCE_NONE","STATE_NOT_UPLOADED","STATE_UPLOADING","STATE_UPLOADED","STATE_ERROR","initialState","mediaDevices","audioAllowed","audioStream","audioUnexpectedEnd","audioSupported","isUserCaptureSupported","displayAllowed","displayStream","displayUnexpectedEnd","displaySupported","isDisplayCaptureSupported","userAllowed","userStream","userUnexpectedEnd","userSupported","videoChoice","audioChoice","isRecording","prematureRecordingEnd","recordings","title","presenter","start","end","upload","error","state","secondsLeft","currentProgress","reducer","action","type","payload","filter","r","deviceType","mapped","map","recording","index","downloaded","Error","stateContext","createContext","dispatchContext","Provider","children","dispatch","useReducer","value","useDispatch","useContext","useStudioState","property","LegalNotices","h2","p","h3","icon","faGlobeEurope","a","href","faEnvelope","faPhone","About","props","sx","maxWidth","margin","h1","Fragment","process","aria-label","Header","colorMode","useColorMode","height","theme","heights","headerHeight","lineHeight","color","display","justifyContent","position","zIndex","backgroundColor","width","opacity","Brand","Navigation","location","useLocation","to","pathname","search","tabIndex","outline","colors","focus","outlineOffset","media","srcSet","src","alt","NavElement","target","rest","exact","activeStyle","pl","pr","textDecoration","fontSize","borderLeft","gray","textAlign","mr","isOpened","updateIsOpened","useState","closeMenu","t","useTranslation","onClick","border","borderRadius","my","px","mx","whiteSpace","faTimes","faCaretDown","ml","ref","n","style","scrollHeight","overflow","top","transition","scrollX","faVideo","faWrench","faKeyboard","faInfoCircle","bottom","left","right","Steps","activeStep","updateActiveStep","childProps","currentStep","totalSteps","length","nextStep","setActiveStep","previousStep","goToStep","firstStep","lastStep","childrenWithProps","React","Children","child","i","isActive","isReactComponent","cloneElement","step","next","isInvalidStep","console","mergeHeightConstraint","maxHeight","videoConstraints","fallbackIdeal","maxField","max","ideal","Math","min","async","startAudioCapture","deviceId","stream","navigator","getUserMedia","audio","video","getTracks","forEach","track","onended","err","startDisplayCapture","settings","maxFps","frameRate","constraints","cursor","getDisplayMedia","startUserCapture","camera","facingMode","stopAudioCapture","stop","stopDisplayCapture","stopUserCapture","configure","defaultKeyEvent","ignoreTags","ignoreEventsCondition","ignoreKeymapAndHandlerChangesByDefault","rewriteKeys","key","find","v","userAgent","includes","replace","recordGroup","editGroup","otherGroup","ctrl","shift","space","recordShortcuts","RECORD_DISPLAY","name","sequences","description","group","RECORD_DISPLAY_CAMERA","RECORD_CAMERA","RECORD_AUDIO","NO_AUDIO","START_RECORDING","STOP_RECORDING","PAUSE_RECORDING","editShortcuts","PLAY_PAUSE","FORWARD_5_SEC","BACKWARDS_5_SEC","FORWARD_1_FRAME","BACKWARDS_1_FRAME","CUT_LEFT","CUT_RIGHT","DELETE_CROP_MARK_LEFT","DELETE_CROP_MARK_RIGHT","otherShortcuts","TAB","NEXT_BUTTON","BACK_BUTTON","UPLOAD","DOWNLOAD","NEW_RECORDING","StepContainer","flexDirection","flex","pt","ActionButtons","prev","handlers","keyEvent","disabled","keyMap","alignItems","minHeight","danger","variant","faCaretLeft","label","faCaretRight","VideoBoxResizeContext","useVideoBoxResize","VideoBox","gap","minWidth","useResizeObserver","setForceCounter","lastDimensions","useRef","undefined","updateLastDimensions","newDimensions","w","h","current","dimensions","c","resizeVideoBox","equal","ar","aspectRatio","childWidth","childHeight","body","aspectRatios","d","rowWidths","rowHeights","availableWidth","combinedAspectRatio","Array","fill","baseHeight","colWidths","colHeights","availableHeight","widths","Notification","isDanger","marginBottom","padding","PreviewAudio","canvasRef","useEffect","canvas","ctx","getContext","lineWidth","strokeStyle","source","window","AudioContext","webkitAudioContext","createMediaStreamSource","scope","Oscilloscope","fftSize","animate","bg","LAST_AUDIO_DEVICE_KEY","AudioSetup","backToVideoSetup","enterStudio","selectNoAudio","selectMicrophone","localStorage","getItem","queryMediaDevices","reselectSource","SourceSelection","MicrophonePreview","mb","OptionButton","faMicrophone","faMicrophoneSlash","currentDeviceId","getAudioTracks","getSettings","devices","getUniqueDevices","setItem","Spacer","htmlFor","id","onChange","e","changeDevice","faExclamationTriangle","size","as","fontFamily","boxShadow","Input","errors","register","required","validate","fontWeight","boxSizing","clear","aria-invalid","aria-describedby","autoComplete","mt","message","RecordingPreview","onDownload","i18n","mimeType","url","blob","flavor","downloadName","recordingFileName","numBytes","round","digits","toLocaleString","language","minimumFractionDigits","maximumFractionDigits","prettyFileSize","pb","muted","onLoadedData","currentTime","preload","faCheckCircle","role","download","rel","faDownload","LAST_PRESENTER_KEY","progressHistory","SaveCreation","useSettings","opencast","useOpencast","uploadState","onProgress","progress","now","Date","push","timestamp","windowStart","findIndex","splice","windowLength","progressPerSecond","progressLeft","handleUpload","result","Boolean","uploadSettings","UPLOAD_SUCCESS","UPLOAD_NETWORK_ERROR","UPLOAD_NOT_AUTHORIZED","UPLOAD_UNEXPECTED_RESPONSE","interval","setInterval","lastProgress","clearInterval","allDownloaded","every","rec","possiblyDone","hideBack","uploadBox","getState","STATE_UNCONFIGURED","STATE_CONNECTED","ConnectionUnconfiguredWarning","UploadProgress","UploadSuccess","UploadForm","borderBottom","DownloadBox","PostAction","goToFirstStep","handleNewRecording","confirm","returnAction","return","isAllowedReturnTarget","faTimesCircle","warn","faRedoAlt","targetUrl","URL","hostname","allowedDomains","some","domain","protocol","elements","document","querySelectorAll","element","click","handleDownload","m","flexWrap","i18nKey","titleField","FORM_FIELD_REQUIRED","presenterField","presenterValue","handleSubmit","useForm","handleInputChange","event","buttonLabel","prettyServerUrl","server","uploadRef","NotConnectedWarning","FORM_FIELD_HIDDEN","defaultValue","faUpload","isVisible","usePageVisibility","retrying","setRetrying","isReadyToUpload","setTimeout","refreshConnection","clearTimeout","problem","onceResolved","STATE_NETWORK_ERROR","STATE_INCORRECT_LOGIN","isLoginProvided","referrer","origin","STATE_RESPONSE_NOT_OK","STATE_INVALID_RESPONSE","roundedPercent","prettyTime","time","Tooltip","content","interactive","tooltip","tooltip_text","prefsToConstraints","prefs","exactDevice","deviceConstraint","parseAspectRatio","aspectRatioConstraint","parseQuality","quality","ASPECT_RATIOS","test","parseInt","LAST_VIDEO_DEVICE_KEY","CAMERA_ASPECT_RATIO_KEY","CAMERA_QUALITY_KEY","DISPLAY_QUALITY_KEY","loadCameraPrefs","loadDisplayPrefs","StreamSettings","isDesktop","expandedHeight","setExpandedHeight","onResize","offsetHeight","updatePrefs","newPrefs","merged","cameraDeviceId","deviceIdOf","isExpanded","setIsExpanded","StreamInfo","offset","old","transform","primary","faCog","fixedWidth","gridTemplateColumns","gridGap","UserSettings","UniveralSettings","py","s","getVideoTracks","sizeInfo","fpsInfo","join","PrefKey","gridColumn","hyphens","PrefValue","overflowX","changeQuality","qualities","out","q","qualityOptions","kind","currentHeight","dimensionsOf","fitState","expectedHeight","RadioButton","checked","arState","currentAr","expectedAr","changeAspectRatio","ratio","x","onKeyDown","SourcePreview","warnings","inputs","StreamPreview","input","text","PreviewVideo","allowed","unexpectedEnd","videoRef","srcObject","addEventListener","removeEventListener","inner","autoPlay","VideoSetup","userHasWebcam","activeSource","setActiveSource","nextDisabled","userWarning","displayWarning","unexpectedEndWarning","userInput","displayInput","hideActionButtons","userConstraints","displayConstraints","hideReselectSource","clickDisplay","clickUser","clickBoth","Promise","all","onMobileDevice","faChalkboard","disabledText","faChalkboardTeacher","faUser","MediaDevices","recordingState","paused","STATE_PAUSED","MediaDevice","pause","play","faPause","animation","background","Recorder","constructor","options","this","data","log","Blob","createObjectURL","onStop","MediaRecorder","mimes","mime","isTypeSupported","debug","videoBitsPerSecond","videoBitrate","ondataavailable","onstop","resume","Button","large","svg","PauseButton","className","faPauseCircle","RecordButton","countdown","faCircleNotch","faCircle","spin","ResumeButton","faPlayCircle","StopButton","faStopCircle","Clock","Component","super","milliseconds","tick","componentDidMount","componentWillUnmount","stopTimer","resumeTimer","timerId","componentDidUpdate","prevProps","isPaused","passed","setState","render","duration","timeArr","slice","unit","addRecordOnStop","mixAudioIntoVideo","videoStream","MediaStream","unblockers","RecordingControls","handleRecorded","setRecordingState","desktopRecorder","videoRecorder","canRecord","history","useHistory","premature","b","STATE_RECORDING","listen","handlePause","handleResume","handleRecord","block","record","handleStop","STATE_INACTIVE","onBeforeunload","preventDefault","Recording","recordingDispatch","backToAudio","useCallback","flexGrow","stopCapture","_path","_extends","Object","assign","arguments","prototype","hasOwnProperty","call","apply","SvgCutOutIcon","titleId","svgRef","focusable","viewBox","xmlns","ForwardRef","_g","SvgCutHereIcon","Review","emptyRecording","previewController","setCurrentTime","previewReady","setPreviewReady","expectedRecordings","Preview","onTimeUpdate","onReady","ControlBox","VideoControls","Scrubber","Infinity","setTime","mouseEvent","rect","getBoundingClientRect","clientX","cutStyle","onMouseMove","buttons","borderRight","leftMarker","rightMarker","controller","isPlaying","isReadyToPlay","switchPlayPause","review","disableCutting","CutControls","marker","innerRef","control","invariant","faPlay","getElementById","context","toUpperCase","faTrash","button","forwardRef","videoRefs","allVideos","desktopIndex","lastOrigin","useImperativeHandle","ended","readyState","durationCalculationProgress","durationsCalculated","setDurationsCalculated","isInCutRegion","overlayVisible","setOverlayVisible","volume","va","vb","fixRequest","frameCounter","fixTime","abs","requestAnimationFrame","cancelAnimationFrame","skipFiveSeconds","skipFrame","pointerEvents","Number","MAX_VALUE","Wizard","isRecordingSupported","languages","short","long","rtl","SettingsSection","LanguageSettings","lang_label","changeLanguage","OpencastSettings","settingsManager","setError","defaultValues","formValues","status","setStatus","hasRecording","onSubmit","oc","Opencast","init","STATE_LOGGED_IN","setGlobalInstance","saveSettings","showServerUrl","isConfigurable","showUsername","isUsernameConfigurable","showPassword","isPasswordConfigurable","testing","faExclamationCircle","saved","startsWith","verticalAlign","ColorModeSettings","setColorMode","getSystemPreference","matchMedia","matches","themes","switchTheme","removeItem","option","SettingsPage","Warnings","onSafari","Group","entries","entry","Entry","params","wordWrap","arr","toString","split","singleKey","singleKey_border","singleKey_bg","alignSelf","KeyboardShortcuts","shortcuts","fromEntries","flatMap","obj","keys","values","groups","_","Routes","PreventClose","path","uploaded","uploading","App","basename","styles","customCSS"],"mappings":"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","file":"static/js/4.ae9e206f.chunk.js","sourcesContent":["//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { createContext, useContext, useReducer } from 'react';\nimport { isDisplayCaptureSupported, isUserCaptureSupported } from './util';\n\n\nexport const AUDIO_SOURCE_MICROPHONE = 'microphone';\nexport const AUDIO_SOURCE_NONE = 'none';\n\nexport const VIDEO_SOURCE_BOTH = 'both';\nexport const VIDEO_SOURCE_DISPLAY = 'display';\nexport const VIDEO_SOURCE_USER = 'user';\nexport const VIDEO_SOURCE_NONE = 'none';\n\nexport const STATE_NOT_UPLOADED = 'not_uploaded';\nexport const STATE_UPLOADING = 'uploading';\nexport const STATE_UPLOADED = 'uploaded';\nexport const STATE_ERROR = 'error';\n\n\nconst initialState = () => ({\n  mediaDevices: [],\n\n  audioAllowed: null,\n  audioStream: null,\n  audioUnexpectedEnd: false,\n  audioSupported: isUserCaptureSupported(),\n\n  displayAllowed: null,\n  displayStream: null,\n  displayUnexpectedEnd: false,\n  displaySupported: isDisplayCaptureSupported(),\n\n  userAllowed: null,\n  userStream: null,\n  userUnexpectedEnd: false,\n  userSupported: isUserCaptureSupported(),\n\n  videoChoice: VIDEO_SOURCE_NONE,\n  audioChoice: AUDIO_SOURCE_NONE,\n\n  isRecording: false,\n  prematureRecordingEnd: false,\n  recordings: [],\n\n  title: '',\n  presenter: '',\n\n  start: null,\n  end: null,\n\n  upload: {\n    error: null,\n    state: STATE_NOT_UPLOADED,\n    secondsLeft: null,\n    currentProgress: 0,\n  },\n});\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'UPDATE_MEDIA_DEVICES':\n      return { ...state, mediaDevices: action.payload };\n\n    case 'CHOOSE_AUDIO':\n      return { ...state, audioChoice: action.payload };\n\n    case 'CHOOSE_VIDEO':\n      return { ...state, videoChoice: action.payload };\n\n    case 'SHARE_AUDIO':\n      return {\n        ...state,\n        audioStream: action.payload,\n        audioAllowed: true,\n        audioUnexpectedEnd: false,\n      };\n\n    case 'BLOCK_AUDIO':\n      return { ...state, audioStream: null, audioAllowed: false, audioUnexpectedEnd: false };\n\n    case 'UNSHARE_AUDIO':\n      return { ...state, audioStream: null, audioUnexpectedEnd: false };\n\n    case 'AUDIO_UNEXPETED_END':\n      return { ...state, audioStream: null, audioUnexpectedEnd: true };\n\n    case 'SHARE_DISPLAY':\n      return {\n        ...state,\n        displayStream: action.payload,\n        displayAllowed: true,\n        displayUnexpectedEnd: false,\n      };\n\n    case 'BLOCK_DISPLAY':\n      return { ...state, displayStream: null, displayAllowed: false, displayUnexpectedEnd: false };\n\n    case 'UNSHARE_DISPLAY':\n      return { ...state, displayStream: null, displayUnexpectedEnd: false };\n\n    case 'DISPLAY_UNEXPETED_END':\n      return { ...state, displayStream: null, displayUnexpectedEnd: true };\n\n    case 'SHARE_USER':\n      return { ...state, userStream: action.payload, userAllowed: true, userUnexpectedEnd: false };\n\n    case 'BLOCK_USER':\n      return { ...state, userStream: null, userAllowed: false, userUnexpectedEnd: false };\n\n    case 'UNSHARE_USER':\n      return { ...state, userStream: null, userUnexpectedEnd: false };\n\n    case 'USER_UNEXPETED_END':\n      return { ...state, userStream: null, userUnexpectedEnd: true };\n\n    case 'START_RECORDING':\n      return { ...state, isRecording: true };\n\n    case 'STOP_RECORDING':\n      return { ...state, isRecording: false };\n\n    case 'STOP_RECORDING_PREMATURELY':\n      return { ...state, isRecording: false, prematureRecordingEnd: true };\n\n    case 'CLEAR_RECORDINGS':\n      return { ...state, recordings: [], prematureRecordingEnd: false };\n\n    case 'ADD_RECORDING':\n      // We remove all recordings with the same device type as the new one. This\n      // *should* in theory never happen as all recordings are cleared before\n      // new ones can be added. However, in rare case, this might not be true\n      // and the user ends up with strange recordings. Just to be sure, we\n      // remove old recordings here.\n      const recordings = [\n        ...state.recordings.filter(r => r.deviceType !== action.payload.deviceType),\n        action.payload,\n      ];\n      return { ...state, recordings };\n\n    case 'UPLOAD_ERROR':\n      return { ...state, upload: { ...state.upload, error: action.payload, state: STATE_ERROR }};\n\n    case 'UPLOAD_REQUEST':\n      return { ...state, upload: { ...state.upload, error: null, state: STATE_UPLOADING }};\n\n    case 'UPLOAD_SUCCESS':\n      return { ...state, upload: { ...state.upload, error: null, state: STATE_UPLOADED }};\n\n    case 'UPLOAD_PROGRESS_UPDATE':\n      return { ...state, upload: {\n        ...state.upload,\n        secondsLeft: action.payload.secondsLeft,\n        currentProgress: action.payload.currentProgress,\n      }};\n\n    case 'MARK_DOWNLOADED':\n      const mapped = state.recordings.map((recording, index) => (\n        index === action.payload ? { ...recording, downloaded: true } : recording\n      ));\n      return { ...state, recordings: mapped };\n\n    case 'UPDATE_TITLE':\n      return { ...state, title: action.payload };\n\n    case 'UPDATE_PRESENTER':\n      return { ...state, presenter: action.payload };\n\n    case 'UPDATE_START':\n      return { ...state, start: action.payload };\n\n    case 'UPDATE_END':\n      return { ...state, end: action.payload };\n\n    case 'RESET':\n      return initialState();\n\n    default:\n      throw new Error();\n  }\n};\n\nconst stateContext = createContext(null);\nconst dispatchContext = createContext(null);\n\nexport const Provider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState());\n\n  return (\n    <dispatchContext.Provider value={dispatch}>\n      <stateContext.Provider value={state}>{children}</stateContext.Provider>\n    </dispatchContext.Provider>\n  );\n};\n\nexport const useDispatch = () => useContext(dispatchContext);\n\nexport const useStudioState = (property = null) => {\n  const state = useContext(stateContext);\n  return property !== null ? state[property] : state;\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport React from 'react';\nimport { jsx, Themed } from 'theme-ui';\nimport { Container } from '@theme-ui/components';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faGlobeEurope, faEnvelope, faPhone } from '@fortawesome/free-solid-svg-icons';\n\nfunction LegalNotices() {\n  return (\n    <article>\n      <Themed.h2>ELAN e.V.</Themed.h2>\n\n      <Themed.p>\n        The e-learning academic network (ELAN e.V.) is a German non-profit organization supporting\n        higher-education organizations in all matters related to e-learning. Our services include\n        practical tips about how to use digital technologies in education, legal advice and\n        development of free, open-source software to support education.\n      </Themed.p>\n\n      <Themed.h3>Contact</Themed.h3>\n\n      <Themed.p>\n        Dr. Norbert Kleinefeld, Geschäftsführer\n        <br />\n        Karlstr. 23\n        <br />\n        D-26123 Oldenburg\n      </Themed.p>\n\n      <Themed.p>\n        <FontAwesomeIcon icon={faGlobeEurope} />{' '}\n        <Themed.a href=\"https://elan-ev.de\">elan-ev.de</Themed.a>\n        <br />\n        <FontAwesomeIcon icon={faEnvelope} />{' '}\n        <Themed.a href=\"mailto:kontakt@elan-ev.de\">kontakt@elan-ev.de</Themed.a>\n        <br />\n        <FontAwesomeIcon icon={faPhone} />{' '}\n        <Themed.a href=\"tel:+4944199866610\">+49&thinsp;441 998&thinsp;666&thinsp;10</Themed.a>\n      </Themed.p>\n\n      <Themed.p>\n        Registergericht: Amtsgericht Oldenburg\n        <br />\n        Registernummer: VR 200644\n        <br />\n        USt.-ID-Nr.: DE 265901392\n      </Themed.p>\n    </article>\n  );\n}\n\nfunction About(props) {\n  return (\n    <Container>\n      <article sx={{ maxWidth: '900px', margin: '0 auto' }}>\n        <header>\n          <Themed.h1>Opencast Studio</Themed.h1>\n        </header>\n        <Themed.p>\n          A web-based recording studio for <Themed.a href=\"https://opencast.org\">Opencast</Themed.a>.\n        </Themed.p>\n        <Themed.p>\n          Opencast Studio allows you to record your camera, your display and your microphoneʼs audio.\n          You can then either download your recordings or upload them directly to an Opencast\n          instance (usually the one of your university).\n        </Themed.p>\n        <Themed.p>\n          This is free software under the terms of the{' '}\n          <Themed.a href=\"https://github.com/elan-ev/opencast-studio/blob/master/LICENSE\">\n            MIT License\n          </Themed.a>{' '}\n          developed by the <Themed.a href=\"https://elan-ev.de\">ELAN e.V.</Themed.a> in cooperation\n          with the <Themed.a href=\"https://ethz.ch\">ETH Zürich</Themed.a>.\n        </Themed.p>\n\n        <Themed.h2>How it works</Themed.h2>\n        <Themed.p>\n          Opencast Studio uses the recording capabilities built into modern browsers to record\n          audio and video streams. The recording happens in the userʼs browser and no server is\n          involved in the recording.\n        </Themed.p>\n\n        { process.env.REACT_APP_INCLUDE_LEGAL_NOTICES === '1' && (\n          <React.Fragment>\n            <Themed.h2>Support</Themed.h2>\n            <Themed.p>\n              If you are experiencing any difficulties or found any bugs,\n              please take a look at the{' '}\n              <Themed.a href=\"https://github.com/elan-ev/opencast-studio/issues\">\n                issue tracker on GitHub\n              </Themed.a>.\n              Before filing a new issue, please check if one about your topic already exists.\n              We regularly check incoming issues and do our best to address bugs in a timely manner.\n            </Themed.p>\n            <Themed.p>\n              If you are interested in additional development\n              or want to support the development of Opencast Studio, please contact{' '}\n              <Themed.a href=\"mailto:opencast-support@elan-ev.de\">\n                opencast-support@elan-ev.de\n              </Themed.a>.\n            </Themed.p>\n          </React.Fragment>\n        )}\n\n        <Themed.h2>Credits</Themed.h2>\n        <Themed.p>\n          Thanks to the following people and institutions for contributing to this project:\n        </Themed.p>\n        <ul>\n          <li>\n            <Themed.a href=\"https://github.com/slampunk\">Duncan Smith</Themed.a> for starting this\n            project\n          </li>\n          <li>\n            <Themed.a href=\"https://github.com/cilt-uct\">University of Cape Town (CILT)</Themed.a>\n            {' '}for letting Duncan start the project\n          </li>\n          <li>\n            <Themed.a href=\"https://ethz.ch\">ETH Zürich</Themed.a> for financial support and\n            testing\n          </li>\n          <li>\n            <Themed.a href=\"https://github.com/elan-ev\">ELAN e.V.</Themed.a> for the re-implementation\n            and the ongoing development\n          </li>\n          <li>\n            And many members from the Opencast community who helped along the way.\n          </li>\n        </ul>\n\n        { process.env.REACT_APP_INCLUDE_LEGAL_NOTICES === '1' && <LegalNotices /> }\n\n        <Themed.h2>Version</Themed.h2>\n        <Themed.p>\n          Build date {process.env.REACT_APP_BUILD_DATE || '?'},\n          commit{' '}\n          <Themed.a\n            aria-label=\"Git commit on GitHub\"\n            href={\"https://github.com/elan-ev/opencast-studio/commit/\"\n                  + process.env.REACT_APP_GIT_SHA }\n          >\n            {process.env.REACT_APP_GIT_SHA || '?'}\n          </Themed.a>.\n        </Themed.p>\n      </article>\n    </Container>\n  );\n}\n\nexport default About;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, useColorMode } from 'theme-ui';\n\nimport { Link, NavLink, useLocation } from 'react-router-dom';\nimport { Fragment, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faCaretDown,\n  faTimes,\n  faWrench,\n  faInfoCircle,\n  faVideo,\n  faKeyboard,\n} from \"@fortawesome/free-solid-svg-icons\";\n\nimport { useStudioState } from '../studio-state';\n\n\n// The header, including a logo on the left and the navigation on the right.\nexport default function Header() {\n  const { isRecording } = useStudioState();\n  const [ colorMode ] = useColorMode();\n\n  return (\n    <header\n      sx={{\n        height: theme => theme.heights.headerHeight,\n        lineHeight: theme => theme.heights.headerHeight,\n        color: 'background',\n        display: 'flex',\n        justifyContent: 'space-between',\n        position: 'relative',\n        zIndex: 3,\n      }}\n    >\n      {/* This div is used just for the background color. We can't set it for\n          the parent element, as the navigation overlay would otherwise occlude\n          this background color */}\n      <div sx={{\n        backgroundColor: colorMode === 'dark' ? 'gray.4' : 'gray.0',\n        position: 'absolute',\n        zIndex: -3,\n        height: '100%',\n        width: '100%',\n      }}></div>\n\n      {/* This div is an overlay that is shown when a recording is currently active.\n          This prevents the user from visiting other pages while recording. */}\n      { isRecording && <div sx={{\n        backgroundColor: colorMode === 'dark' ? 'gray.4' : 'gray.0',\n        position: 'absolute',\n        zIndex: 20,\n        height: '100%',\n        width: '100%',\n        opacity: 0.75,\n      }}/>}\n\n      {/* Actual content */}\n      <Brand />\n      <Navigation />\n    </header>\n  );\n}\n\nconst Brand = () => {\n  const location = useLocation();\n  const { isRecording } = useStudioState();\n\n  return (\n    <Link to={{ pathname: '/', search: location.search }}\n      tabIndex={isRecording ? '-1' : '0'}\n      sx={{ ':focus-visible': {\n        outline: theme => `5px solid ${theme.colors.focus[2]} !important`,\n        outlineOffset: '-5px',\n      }\n      }}>\n      <picture sx={{ display: 'block', height: theme => theme.heights.headerHeight }}>\n        <source\n          media=\"(min-width: 920px)\"\n          srcSet={`${process.env.PUBLIC_URL}/opencast-studio.svg`}\n        />\n        <img\n          src={`${process.env.PUBLIC_URL}/opencast-studio-small.svg`}\n          alt=\"Opencast Studio\"\n          sx={{ height: theme => theme.heights.headerHeight }}\n        />\n      </picture>\n    </Link>\n  );\n};\n\n// One element (link) in the navigation.\nconst NavElement = ({ target, children, icon, ...rest }) => {\n  const location = useLocation();\n  const { isRecording } = useStudioState();\n  const [ colorMode ] = useColorMode();\n\n  return (\n    <NavLink\n      to={{\n        pathname: target,\n        search: location.search,\n      }}\n      tabIndex={isRecording ? '-1' : '0'}\n      exact\n      activeStyle={{\n        backgroundColor: 'black',\n      }}\n      sx={{\n        color: 'white',\n        pl: [3, '12px'],\n        pr: [3, '12px'],\n        textDecoration: 'none',\n        fontSize: '18px',\n        height: ['auto', '100%'],\n        borderLeft: ['none', theme => `1px solid ${theme.colors.gray[colorMode === 'dark' ? 1 : 3]}`],\n        display: ['block', 'inline-block'],\n        width: ['100%', 'auto'],\n\n        '&:hover': {\n          backgroundColor: colorMode === 'dark' ? 'gray.3' : 'gray.1',\n        },\n        ':focus-visible': {\n          outline: theme => `5px solid ${theme.colors.focus[2]} !important`,\n          outlineOffset: '-5px',\n        },\n      }}\n      {...rest}\n    >\n      <div sx={{\n        width: '20px',\n        display: 'inline-block',\n        textAlign: 'right',\n        mr: [3, 3, 2],\n        '@media screen and (max-width: 742px)': {\n          mr: [0, 0, 0],\n        },\n        '@media screen and (max-width: 575px)': {\n          mr: [3, 3, 2],\n        }\n      }}>\n        <FontAwesomeIcon icon={icon} />\n      </div>\n      <div sx={{\n        display: 'inline-block',\n        '@media screen and (max-width: 742px)': {\n          display: 'none'\n        },\n        '@media screen and (max-width: 575px)': {\n          display: 'inline-block',\n        }\n      }}>\n        {children}\n      </div>\n    </NavLink>\n  );\n};\n\n// The whole responsive navigation element.\nconst Navigation = props => {\n  const [isOpened, updateIsOpened] = useState(false);\n  const toggleMenu = () => updateIsOpened(!isOpened);\n  const closeMenu = () => updateIsOpened(false);\n  const { t } = useTranslation();\n  const [colorMode] = useColorMode();\n\n  return (\n    <Fragment>\n      <button\n        onClick={toggleMenu}\n        title={t('nav-open-menu-button')}\n        sx={{\n          display: ['inline-block', 'none'],\n          border: theme => `2px solid ${theme.colors.gray[3]}`,\n          borderRadius: '10px',\n          color: 'white',\n          my: 1,\n          px: 3,\n          mx: 1,\n          fontSize: '20px',\n          whiteSpace: 'nowrap',\n          backgroundColor: 'transparent',\n          '&:hover': {\n            backgroundColor: 'gray.1',\n          },\n          '&:active': {},\n        }}\n      >\n        {t('nav-open-menu-button')}\n        <span sx={{ width: '23px', display: 'inline-block' }}>\n          <FontAwesomeIcon\n            icon={isOpened ? faTimes : faCaretDown}\n            sx={{ ml: '10px' }}\n          />\n        </span>\n      </button>\n      <nav\n        ref={n => {\n          if (n) {\n            n.style.height = isOpened ? n.scrollHeight + 'px' : \"\";\n          }\n        }}\n        sx={{\n          overflow: 'hidden',\n          zIndex: 10,\n          // This \"!important\" is necessary unfortunately to override the inline\n          // style set in the `ref` attribute above. Otherwise opening the menu\n          // in mobile view and switching to desktop view (e.g. by rotating\n          // phone) would result in a very strange artifact.\n          height: ['0px', '100% !important'],\n          top: [theme => theme.heights.headerHeight, theme => theme.heights.headerHeight, 0],\n          position: ['absolute', 'static'],\n          width: ['100%', 'auto'],\n          backgroundColor: [colorMode === 'dark' ? 'gray.4' : 'gray.0', 'none'],\n          transition: ['height 0.25s ease-out 0s', 'none'],\n          scrollX: ['none', 'auto'],\n        }}\n      >\n        <NavElement\n          target=\"/\"\n          icon={faVideo}\n          onClick={closeMenu}\n        >\n          {t('nav-recording')}\n        </NavElement>\n        <NavElement\n          target=\"/settings\"\n          icon={faWrench}\n          onClick={closeMenu}\n        >\n          {t('nav-settings')}\n        </NavElement>\n        <NavElement\n          target=\"/shortcuts\"\n          icon={faKeyboard}\n          onClick={closeMenu}\n        >\n          {t('nav-shortcuts')}\n        </NavElement>\n        <NavElement\n          target=\"/about\"\n          icon={faInfoCircle}\n          onClick={closeMenu}\n        >\n          {t('nav-about')}\n        </NavElement>\n      </nav>\n\n      {/* A black, half-transparent overlay over the body */}\n      {isOpened && <div\n        onClick={closeMenu}\n        ref={n => n && (n.style.opacity = 1)}\n        sx={{\n          display: [isOpened ? 'block' : 'none', 'none'],\n          backgroundColor: 'rgba(0, 0, 0, 0.7)',\n          position: 'fixed',\n          zIndex: -10,\n          top: 0,\n          bottom: 0,\n          left: 0,\n          right: 0,\n          opacity: 0,\n          transition: 'opacity 0.25s ease-out 0s',\n        }}\n      ></div>}\n    </Fragment>\n  );\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport React from 'react';\n\nexport default function Steps({ activeStep, updateActiveStep, ...props }) {\n  const childProps = {\n    currentStep: activeStep + 1,\n    totalSteps: props.children?.length || 0,\n    nextStep,\n    previousStep,\n    goToStep,\n    firstStep,\n    lastStep\n  };\n\n  const childrenWithProps = React.Children.map(props.children, (child, i) => {\n    childProps.isActive = i === activeStep;\n\n    return childProps.isActive\n      ? isReactComponent(child)\n        ? React.cloneElement(child, childProps)\n        : child\n      : null;\n  });\n\n  return <React.Fragment>{childrenWithProps}</React.Fragment>;\n\n  function firstStep() {\n    goToStep(1);\n  }\n\n  function lastStep() {\n    goToStep(props.children.length);\n  }\n\n  function nextStep() {\n    setActiveStep(activeStep + 1);\n  }\n\n  function previousStep() {\n    setActiveStep(activeStep - 1);\n  }\n\n  function goToStep(step) {\n    setActiveStep(step - 1);\n  }\n\n  function setActiveStep(next) {\n    if (activeStep === next) {\n      return;\n    }\n    if (isInvalidStep(next, props.children)) {\n      console.error(`${next + 1} is an invalid step`);\n      return;\n    }\n\n    updateActiveStep(next);\n  }\n}\n\nfunction isInvalidStep(next, children) {\n  return next < 0 || next >= children.length;\n}\n\nfunction isReactComponent({ type }) {\n  return typeof type === 'function' || typeof type === 'object';\n}\n","const mergeHeightConstraint = (maxHeight, videoConstraints, fallbackIdeal) => {\n  const maxField = maxHeight && { max: maxHeight };\n  const ideal = videoConstraints?.height?.ideal || fallbackIdeal;\n  const idealField = ideal && (maxHeight ? { ideal: Math.min(ideal, maxHeight) } : { ideal });\n\n  return { height: { ...maxField, ...idealField }};\n};\n\nexport async function startAudioCapture(dispatch, deviceId = null) {\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      audio: deviceId ? { deviceId } : true,\n      video: false\n    });\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: 'AUDIO_UNEXPETED_END' });\n      };\n    });\n\n    dispatch({ type: 'SHARE_AUDIO', payload: stream });\n  } catch (err) {\n    // TODO: there several types of exceptions; certainly we should differentiate here one day\n    console.error('Error: ' + err);\n\n    dispatch({ type: 'BLOCK_AUDIO' });\n  }\n}\n\nexport async function startDisplayCapture(dispatch, settings, videoConstraints = {}) {\n  const maxFps = settings.display?.maxFps\n    ? { frameRate: { max: settings.display.maxFps }}\n    : {};\n  const height = mergeHeightConstraint(settings.display?.maxHeight, videoConstraints);\n\n  const constraints = {\n    video: {\n      cursor: 'always',\n      ...maxFps,\n      ...videoConstraints,\n      ...height,\n    },\n    audio: false,\n  };\n\n  try {\n    const stream = await navigator.mediaDevices.getDisplayMedia(constraints);\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: 'DISPLAY_UNEXPETED_END' });\n      };\n    });\n\n    dispatch({ type: 'SHARE_DISPLAY', payload: stream });\n  } catch (err) {\n    // TODO: there 7 types of exceptions; certainly we should differentiate here one day\n    console.error('Error: ' + err);\n\n    dispatch({ type: 'BLOCK_DISPLAY' });\n  }\n}\n\nexport async function startUserCapture(dispatch, settings, videoConstraints) {\n  const maxFps = settings.camera?.maxFps\n    ? { frameRate: { max: settings.camera.maxFps }}\n    : {};\n  const height = mergeHeightConstraint(settings.camera?.maxHeight, videoConstraints, 1080);\n\n  const constraints = {\n    video: {\n      facingMode: 'user',\n      ...videoConstraints,\n      ...maxFps,\n      ...height,\n    },\n    audio: false,\n  };\n\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia(constraints);\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: 'USER_UNEXPETED_END' });\n      };\n    });\n    dispatch({ type: 'SHARE_USER', payload: stream });\n  } catch (err) {\n    // TODO: there 7 types of exceptions; certainly we should differentiate here one day\n    console.error('Error: ' + err);\n\n    dispatch({ type: 'BLOCK_USER' });\n  }\n}\n\n// ----------------------------------------------------------------------------\n\nexport function stopCapture({ audioStream, displayStream, userStream }, dispatch) {\n  stopAudioCapture(audioStream, dispatch);\n  stopDisplayCapture(displayStream, dispatch);\n  stopUserCapture(userStream, dispatch);\n}\n\nexport function stopAudioCapture(stream, dispatch) {\n  stream?.getTracks().forEach(track => track.stop());\n  dispatch({ type: 'UNSHARE_AUDIO' });\n}\n\nexport function stopDisplayCapture(stream, dispatch) {\n  stream?.getTracks().forEach(track => track.stop());\n  dispatch({ type: 'UNSHARE_DISPLAY' });\n}\n\nexport function stopUserCapture(stream, dispatch) {\n  stream?.getTracks().forEach(track => track.stop());\n  dispatch({ type: 'UNSHARE_USER' });\n}\n","import { configure } from 'react-hotkeys';\n\n/**\n * https://github.com/greena13/react-hotkeys\n * By default, all key events that originate from <input>, <select> or <textarea>,\n * or have a isContentEditable attribute of true are ignored by react-hotkeys.\n */\nconfigure({\n  defaultKeyEvent: 'keydown',\n  ignoreTags: ['input'],\n  ignoreEventsCondition: function() {},\n  ignoreKeymapAndHandlerChangesByDefault: false,\n});\n\n/**\n * Helper functions that rewrites keys based on the OS\n*/\nconst getOs = () => {\n  const os = ['Windows', 'Linux', 'Mac'];\n  return os.find(v => navigator.userAgent.includes(v));\n};\n\nconst rewriteKeys = key => getOs() === 'Mac' ? key.replace('Alt', 'Option') : key;\n\n// Groups for displaying shortcuts in the overview page\nconst recordGroup = 'record-shortcuts';\nconst editGroup = 'edit-shortcuts';\nconst otherGroup = 'other-shortcuts';\n\nconst ctrl = 'control-key';\nconst shift = 'shift-key';\nconst space = 'space-key';\nconst left = 'left-key';\nconst right = 'right-key';\n\n// Shortcuts for recording\nexport const recordShortcuts = {\n  RECORD_DISPLAY: {\n    name: 'record-display',\n    sequences: ['1'],\n    description: ['1'],\n    group: recordGroup,\n  },\n  RECORD_DISPLAY_CAMERA: {\n    name: 'record-both',\n    sequences: ['2'],\n    description: ['2'],\n    group: recordGroup,\n  },\n  RECORD_CAMERA: {\n    name: 'record-camera',\n    sequences: ['3'],\n    description: ['3'],\n    group: recordGroup,\n  },\n  RECORD_AUDIO: {\n    name: 'record-audio',\n    sequences: ['1'],\n    description: ['1'],\n    group: recordGroup,\n  },\n  NO_AUDIO: {\n    name: 'record-no-audio',\n    sequences: ['2'],\n    description: ['2'],\n    group: recordGroup,\n  },\n  START_RECORDING: {\n    name: 'start-recording',\n    sequences: ['r'],\n    description: ['r'],\n    group: recordGroup,\n  },\n  STOP_RECORDING: {\n    name: 'stop-recording',\n    sequences: ['s'],\n    description: ['s'],\n    group: recordGroup,\n  },\n  PAUSE_RECORDING: {\n    name: 'pause-recording',\n    sequences: ['Space', 'k'],\n    description: [space, 'k'],\n    group: recordGroup,\n  }\n};\n\n// Shortcuts for editing\nexport const editShortcuts = {\n  PLAY_PAUSE: {\n    name: 'play-pause',\n    sequences: ['Space', 'k'],\n    description: [space, 'k'],\n    group: editGroup,\n  },\n  FORWARD_5_SEC: {\n    name: 'skip-five',\n    sequences: ['l', 'ArrowRight'],\n    description: ['l', right],\n    group: editGroup,\n  },\n  BACKWARDS_5_SEC: {\n    name: 'back-five',\n    sequences: ['j', 'ArrowLeft'],\n    description: ['j', left],\n    group: editGroup,\n  },\n  FORWARD_1_FRAME: {\n    name: 'frame-forward',\n    sequences: ['.'],\n    description: ['.'],\n    group: editGroup,\n  },\n  BACKWARDS_1_FRAME: {\n    name: 'frame-back',\n    sequences: [','],\n    description: [','],\n    group: editGroup,\n  },\n  CUT_LEFT: {\n    name: 'cut-left',\n    sequences: ['n'],\n    description: ['n'],\n    group: editGroup,\n  },\n  CUT_RIGHT: {\n    name: 'cut-right',\n    sequences: ['m'],\n    description: ['m'],\n    group: editGroup,\n  },\n  DELETE_CROP_MARK_LEFT: {\n    name: 'delete-left',\n    sequences: ['Shift+n'],\n    description: [shift + '+n'],\n    group: editGroup,\n  },\n  DELETE_CROP_MARK_RIGHT: {\n    name: 'delete-right',\n    sequences: ['Shift+m'],\n    description: [shift + '+m'],\n    group: editGroup,\n  }\n};\n\nexport const otherShortcuts = {\n  TAB: {\n    name: 'tab-elements',\n    sequences: [],\n    description: ['Tab'],\n    group: otherGroup,\n  },\n  NEXT_BUTTON: {\n    name: 'next-button',\n    sequences: ['Control+ArrowRight'],\n    description: [ctrl + '+' + right],\n    group: otherGroup,\n  },\n  BACK_BUTTON: {\n    name: 'back-button',\n    sequences: ['Control+ArrowLeft'],\n    description: [ctrl + '+' + left],\n    group: otherGroup,\n  },\n  UPLOAD: {\n    name: 'upload-video',\n    sequences: [rewriteKeys('Alt+u')],\n    description: [rewriteKeys('Alt+u')],\n    group: otherGroup,\n  },\n  DOWNLOAD: {\n    name: 'download-video',\n    sequences: ['d'],\n    description: ['d'],\n    group: otherGroup,\n  },\n  NEW_RECORDING: {\n    name: 'new-recording',\n    sequences: ['Shift+n'],\n    description: [shift + '+n'],\n    group: otherGroup,\n  }\n};\n\nexport const getShortcuts = () => (\n  Object.fromEntries([recordShortcuts, editShortcuts, otherShortcuts].flatMap(Object.entries))\n);\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport useResizeObserver from \"use-resize-observer/polyfilled\";\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCaretLeft, faCaretRight } from '@fortawesome/free-solid-svg-icons';\nimport { Box, Button, Flex } from '@theme-ui/components';\nimport { useTranslation } from 'react-i18next';\nimport React, { useRef, useState } from 'react';\nimport equal from 'fast-deep-equal';\n\nimport { GlobalHotKeys } from 'react-hotkeys';\nimport { otherShortcuts } from '../studio/keyboard-shortcuts/globalKeys';\n\n// A full width flex container for some steps of the wizard.\nexport const StepContainer = ({ children }) => (\n  <div\n    sx={{\n      display: 'flex',\n      flexDirection: 'column',\n      flex: '1 1 auto',\n      justifyContent: 'space-between',\n      p: 3,\n      pt: [2, 2, 3],\n      '& > h1': {\n        textAlign: 'center',\n        fontSize: ['24px', '27px', '32px'],\n      },\n    }}\n  >\n    { children }\n  </div>\n);\n\n// A div containing optional \"back\" and \"next\" buttons as well as the centered\n// children. The props `prev` and `next` are objects with the follwing fields:\n//\n// - `onClick`: forwarded to the `<Button>`\n// - `disabled`: forwarded to the `<Button>`\n// - `label` (optional): the button label translation string. If not specified,\n//   the label is 'back-button-label' or 'next-button-label'.\n// - `danger` (optional): forwarded to the `<Button>`, default: `false`.\nexport function ActionButtons({ prev = null, next = null, children }) {\n  const { t } = useTranslation();\n\n  const handlers = {\n    BACK_BUTTON: keyEvent => { if(prev) { prev.onClick(keyEvent); } },\n    NEXT_BUTTON: keyEvent => { if(next && !next.disabled) { next.onClick(keyEvent); } },\n  };\n\n  return (\n    <GlobalHotKeys keyMap={otherShortcuts} handlers={handlers}>\n      <Flex sx={{ alignItems: 'end', minHeight: '40px' }}>\n        <Box sx={{ flex: '1 1 0', textAlign: 'left' }}>\n          { prev && (\n            <Button\n              sx={{\n                whiteSpace: 'nowrap',\n                ...prev.danger === true ? { variant: 'buttons.danger' } : { variant: 'buttons.text' }\n              }}\n              onClick={prev.onClick}\n              disabled={prev.disabled}\n              danger={prev.danger || false}\n            >\n              <FontAwesomeIcon icon={faCaretLeft} />\n              {t(prev.label || 'back-button-label')}\n            </Button>\n          )}\n        </Box>\n        <Box>{children}</Box>\n        <Box sx={{ flex: '1 1 0', textAlign: 'right' }}>\n          { next && (\n            <Button\n              sx={{\n                whiteSpace: 'nowrap',\n                '& svg': { mr: 0, ml: 2 },\n                ...next.danger === true ? { variant: 'buttons.danger' } : {}\n              }}\n              onClick={next.onClick}\n              disabled={next.disabled}\n            >\n              {t(next.label || 'next-button-label')}\n              <FontAwesomeIcon icon={faCaretRight} />\n            </Button>\n          )}\n        </Box>\n      </Flex>\n    </GlobalHotKeys>\n  );\n}\n\nconst VideoBoxResizeContext = React.createContext(null);\n\nexport const useVideoBoxResize = () => React.useContext(VideoBoxResizeContext);\n\n// Manages one or two children with given aspect ratio.\n//\n// Each child is given an aspect ratio. The child will be rendered within a\n// `<div>` that maintains this exact aspect ratio. In the one child case, that\n// `<div>` also perfectly fits within the parent container. In the case of two\n// children, those children are laid out in such a way that the utilized screen\n// space is maximized while both children have the same width or height.\n//\n// `children` has to be the length 1 or 2! The parameter `gap` specifies the\n// width of the empty space between the two children in the case that two\n// children are given.\n//\n// Each child in `children` needs to be an object with the following fields:\n//\n// - `body`: the rendered DOM.\n// - `dimensions`: a function returning `[width, height]` of the child (also\n//   defining the aspect ratio). We require the dimensions instead of only the\n//   aspect ratio to better detect changes in the video stream.\nexport function VideoBox({ gap = 0, minWidth = 180, minHeight = 140, children }) {\n  const { ref, width = 1, height = 1 } = useResizeObserver();\n\n  // This is a dummy state to force a rerender.\n  const [, setForceCounter] = useState(0);\n  const forceRender = () => setForceCounter(v => v + 1);\n\n  // We try to remember the last valid dimension. Otherwise, changing video\n  // preferences for a non-16:9 strean leads to visual noise: the box always\n  // changes between its aspect ratio and the fallback 16:9 ratio.\n  const lastDimensions = useRef(children.map(() => [undefined, undefined]));\n  const updateLastDimensions = newDimensions => {\n    newDimensions.forEach(([w, h], i) => {\n      if (w && h) {\n        lastDimensions.current[i] = [w, h];\n      }\n    });\n  };\n\n  // Setup the handler for when a video stream is resized.\n  let dimensions = children.map(c => c.dimensions());\n  updateLastDimensions(dimensions);\n  const resizeVideoBox = () => {\n    const newDimensions = children.map(c => c.dimensions());\n    if (!equal(newDimensions, dimensions)) {\n      dimensions = newDimensions;\n      updateLastDimensions(dimensions);\n      forceRender();\n    }\n  };\n\n  const ar = ([width, height]) => width && height ? width / height : 16 / 9;\n\n  switch (children.length) {\n    case 1: {\n      const child = children[0];\n      const aspectRatio = ar(lastDimensions.current[0]);\n\n      // Calculate size of child\n      let childWidth;\n      let childHeight;\n\n      if (width > height * aspectRatio) {\n        // Child height perfectly matches container, extra space left and right\n        childHeight = height;\n        childWidth = height * aspectRatio;\n      } else {\n        // Child width perfectly matches container, extra space top and bottom\n        childWidth = width;\n        childHeight = (width / aspectRatio);\n      }\n\n      return (\n        <VideoBoxResizeContext.Provider value={resizeVideoBox}>\n          <div ref={ref} sx={{ flex: '1 0 0', minHeight, display: 'flex' }}>\n            <div sx={{\n              height: childHeight,\n              width: childWidth,\n              minWidth: `${minWidth}px`,\n              margin: 'auto',\n            }}>\n              { child.body }\n            </div>\n          </div>\n        </VideoBoxResizeContext.Provider>\n      );\n    }\n    case 2: {\n      // We need to decide whether the two videos are side by side or if one\n      // should be below the other. We calculate the utilized space for each\n      // option and then take the option that utilizes more space.\n      //\n      // Below we need to figure out the aspect ratios of the combined videos\n      // either in row or column layout. Consider this table:\n      //\n      // |             | a      | b      | row    | column |\n      // | ----------- | ------ | ------ | ------ | ------ |\n      // | aspect      | 16:9   | 4:3    | 28:9   | 16:21  |\n      // | normalized  | 1.77:1 | 1.33:1 | 3.11:1 | 0.76:1 |\n      //\n      // It shows the two aspect ratios a and b combined in both ways. In the\n      // \"row\" case, the combined aspect ratio is simple: just add both children\n      // aspect ratios. The column case is more difficult. First we have to\n      // normalize both with respect to the width. This results in 1:0.56 and\n      // 1:0.75 respectively. We can now add those, resulting in 1:1.31.\n      // Finally, we normalize with respect to height again: 0.76:1\n\n      const aspectRatios = lastDimensions.current.map(d => ar(d));\n\n      // Videos side by side (row).\n      const { rowWidths, rowHeights } = (() => {\n        const availableWidth = width - gap;\n        const combinedAspectRatio = aspectRatios[0] + aspectRatios[1];\n        if (availableWidth > height * combinedAspectRatio) {\n          // Children height perfectly matches container, extra space left and\n          // right.\n          return {\n            rowHeights: Array(2).fill(height),\n            rowWidths: aspectRatios.map(ar => height * ar),\n          };\n        } else {\n          // Children width perfectly matches container, extra space top and\n          // bottom.\n          const baseHeight = availableWidth / combinedAspectRatio;\n          return {\n            rowHeights: children.map(c => baseHeight),\n            rowWidths: aspectRatios.map(ar => baseHeight * ar),\n          };\n        }\n      })();\n\n      // One video below the other (col/column).\n      const { colWidths, colHeights } = (() => {\n        const availableHeight = height - gap;\n        const combinedAspectRatio =\n          1 / ((1 / aspectRatios[0]) + (1 / aspectRatios[1]));\n\n        if (width > availableHeight * combinedAspectRatio) {\n          // Children height perfectly matches container, extra space left and\n          // right.\n          const width = availableHeight * combinedAspectRatio;\n          return {\n            colHeights: children.map((c, i) => (width / aspectRatios[i])),\n            colWidths: Array(2).fill(width),\n          };\n        } else {\n          // Children width perfectly matches container, extra space top and\n          // bottom.\n          return {\n            colHeights: children.map((c, i) => (width / aspectRatios[i])),\n            colWidths: Array(2).fill(width),\n          };\n        }\n      })();\n\n      // Finally, we compare the areas the two layouts would use. The one with\n      // the larger area utilized wins.\n      const rowArea = rowWidths[0] * rowHeights[0] + rowWidths[1] * rowHeights[1];\n      const colArea = colWidths[0] * colHeights[0] + colWidths[1] * colHeights[1];\n      let widths;\n      let heights;\n      let flexDirection;\n      if (rowArea > colArea) {\n        flexDirection = 'row';\n        widths = rowWidths;\n        heights = rowHeights;\n      } else {\n        flexDirection = 'column';\n        widths = colWidths;\n        heights = colHeights;\n      }\n\n      return (\n        <VideoBoxResizeContext.Provider value={resizeVideoBox}>\n          <div\n            ref={ref}\n            sx={{\n              flex: '1 0 0',\n              display: 'flex',\n              flexDirection,\n              justifyContent: 'space-between',\n              minHeight,\n            }}\n          >\n            <div sx={{\n              height: heights[0],\n              width: widths[0],\n              minWidth: `${minWidth}px`,\n              margin: 'auto',\n            }}>\n              { children[0].body }\n            </div>\n            <div sx={{\n              height: heights[1],\n              width: widths[1],\n              minWidth: `${minWidth}px`,\n              margin: 'auto',\n            }}>\n              { children[1].body }\n            </div>\n          </div>\n        </VideoBoxResizeContext.Provider>\n      );\n    }\n    default:\n      return <p>Internal error: too few or too many video streams</p>;\n  }\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nconst Notification = ({ isDanger, ...rest }) => (\n  <div\n    sx={{\n      ':not(:last-child)': { marginBottom: '1.5rem' },\n      backgroundColor: isDanger ? 'error' : 'gray.3',\n      color: isDanger ? 'notification_text' : 'currentColor',\n      borderRadius: 2,\n      padding: 3,\n      position: 'relative'\n    }}\n    {...rest}\n  />\n);\n\nexport default Notification;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport Oscilloscope from 'oscilloscope';\nimport { useEffect, useRef } from 'react';\n\nexport default function PreviewAudio({ stream }) {\n  const canvasRef = useRef();\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const ctx = canvas.getContext('2d');\n      ctx.lineWidth = 2;\n      ctx.strokeStyle = '#f1c40f';\n\n      const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      const source = audioContext.createMediaStreamSource(stream);\n      const scope = new Oscilloscope(source, { fftSize: 1024 });\n      scope.animate(ctx);\n\n      return () => scope.stop();\n    }\n    return () => {};\n  }, [stream]);\n\n  return (\n    <canvas\n      ref={canvasRef}\n      width=\"800px\"\n      height=\"200px\"\n      sx={{\n        width: '100%',\n        maxHeight: '200px',\n        minHeight: 0,\n        flex: '1 0 70px',\n        bg: 'rgba(0,0,0,0.8)',\n        borderRadius: '7px',\n      }}\n    />\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Themed } from 'theme-ui';\n\nimport { Flex, Heading, Spinner, Text } from '@theme-ui/components';\nimport { useEffect, Fragment } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faMicrophone,\n  faMicrophoneSlash,\n  faExclamationTriangle,\n} from '@fortawesome/free-solid-svg-icons';\n\nimport {\n  useDispatch,\n  useStudioState,\n  AUDIO_SOURCE_MICROPHONE,\n  AUDIO_SOURCE_NONE,\n} from '../../../studio-state';\n\nimport { startAudioCapture, stopAudioCapture } from '../capturer';\nimport { ActionButtons, StepContainer } from '../elements';\nimport Notification from '../../notification';\nimport { queryMediaDevices, getUniqueDevices } from '../../../util';\n\nimport PreviewAudio from './preview-audio';\n\nimport { GlobalHotKeys } from 'react-hotkeys';\nimport { recordShortcuts } from '../keyboard-shortcuts/globalKeys';\n\nconst LAST_AUDIO_DEVICE_KEY = 'ocStudioLastAudioDevice';\n\n// The audio setup page. This component manages the state (either 'none\n// selected' or 'microphone selected') and renders the correct component.\nexport default function AudioSetup(props) {\n  const dispatch = useDispatch();\n  const { audioStream, audioChoice } = useStudioState();\n\n  const backToVideoSetup = () => props.previousStep();\n  const enterStudio = () => props.nextStep();\n\n  const selectNoAudio = () => enterStudio();\n  const selectMicrophone = async() => {\n    dispatch({ type: 'CHOOSE_AUDIO', payload: AUDIO_SOURCE_MICROPHONE });\n    const deviceId = window.localStorage.getItem(LAST_AUDIO_DEVICE_KEY);\n    await startAudioCapture(dispatch, deviceId ? { ideal: deviceId } : null);\n    await queryMediaDevices(dispatch);\n  };\n  const reselectSource = () => {\n    if (audioStream) {\n      stopAudioCapture(audioStream, dispatch);\n    }\n    dispatch({ type: 'CHOOSE_AUDIO', payload: AUDIO_SOURCE_NONE });\n  };\n\n  const body = (() => {\n    switch (audioChoice) {\n      case AUDIO_SOURCE_NONE:\n        return <SourceSelection {...{ selectNoAudio, selectMicrophone, backToVideoSetup }} />;\n      case AUDIO_SOURCE_MICROPHONE:\n        return <MicrophonePreview {...{ reselectSource, enterStudio }} />;\n      default:\n        return 'internal error :-(';\n    }\n  })();\n\n  return <StepContainer>{ body }</StepContainer>;\n}\n\n// The two large option buttons for \"no audio\" and \"Microphone\".\nconst SourceSelection = ({ selectNoAudio, selectMicrophone, backToVideoSetup }) => {\n  const { t } = useTranslation();\n\n  const handlers = {\n    RECORD_AUDIO: keyEvent => { if(keyEvent) { selectMicrophone(keyEvent); } },\n    NO_AUDIO: keyEvent => { if(keyEvent) { selectNoAudio(keyEvent); } },\n  };\n\n  return (\n    <GlobalHotKeys keyMap={recordShortcuts} handlers={handlers}>\n      <Fragment>\n        <Themed.h1>{t('sources-audio-question')}</Themed.h1>\n\n        <Flex\n          sx={{\n            flexDirection: ['column', 'row'],\n            maxWidth: 850,\n            width: '100%',\n            mx: 'auto',\n            mb: 3,\n            flex: '1 0 auto',\n            maxHeight: ['none', '350px'],\n            '& > :first-of-type': {\n              mb: [3, 0],\n              mr: [0, 3],\n            },\n          }}\n        >\n          <OptionButton\n            icon={faMicrophone}\n            label={t('sources-audio-microphone')}\n            onClick={selectMicrophone}\n          />\n          <OptionButton\n            icon={faMicrophoneSlash}\n            label={t('sources-audio-without-audio')}\n            onClick={selectNoAudio}\n          />\n        </Flex>\n\n        <ActionButtons prev={{ onClick: backToVideoSetup }} />\n      </Fragment>\n    </GlobalHotKeys>\n  );\n};\n\n// Once the microphone is selected, this is shown. Renders an\n// audio-visualization and a device-selector.\nconst MicrophonePreview = ({ reselectSource, enterStudio }) => {\n  const { t } = useTranslation();\n  const dispatch = useDispatch();\n  const state = useStudioState();\n  const { audioStream, audioAllowed, audioUnexpectedEnd } = state;\n\n  // Get current device ID and all possible audio input devices.\n  const currentDeviceId = audioStream?.getAudioTracks()?.[0]?.getSettings()?.deviceId;\n  const devices = getUniqueDevices(state.mediaDevices, 'audioinput');\n\n  // We write the currently used device ID to local storage to remember it\n  // between visits of Studio.\n  useEffect(() => {\n    if (currentDeviceId) {\n      window.localStorage.setItem(LAST_AUDIO_DEVICE_KEY, currentDeviceId);\n    }\n  });\n\n  const changeDevice = async deviceId => {\n    // The stream is only falsy if it unexpectedly ended.\n    if (audioStream) {\n      stopAudioCapture(audioStream, dispatch);\n    }\n\n    await startAudioCapture(dispatch, { exact: deviceId });\n  };\n\n  const Spacer = ({ min, max }) => <div sx={{ flex: 1, maxHeight: max, minHeight: min }} />;\n\n  let body;\n  if (audioStream) {\n    body = <Fragment>\n      <PreviewAudio stream={audioStream} />\n      <div sx={{\n        display: 'flex',\n        width: '80%',\n        my: 3,\n        fontSize: '18px',\n        minWidth: '285px',\n        'align-items': 'center'\n      }}>\n        <label htmlFor=\"sources-audio-device\"\n          sx={{\n            mr: 3,\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n          }}>{ t('sources-audio-device') }:</label>\n        <select\n          id=\"sources-audio-device\"\n          sx={{ variant: 'styles.select', flex: '1 0 0', minWidth: 0 }}\n          value={currentDeviceId}\n          onChange={e => changeDevice(e.target.value)}\n        >\n          {\n            devices.map((d, i) => (\n              <option key={i} value={d.deviceId}>{ d.label || \"unlabeled microphone\" }</option>\n            ))\n          }\n        </select>\n      </div>\n    </Fragment>;\n  } else if (audioAllowed === false) {\n    body = <Fragment>\n      <FontAwesomeIcon icon={faExclamationTriangle} size=\"3x\" />\n      <Spacer min=\"16px\" max=\"48px\" />\n      <Notification isDanger>\n        <Heading as=\"h3\" mb={2}>\n          {t('source-audio-not-allowed-title')}\n        </Heading>\n        <Text variant=\"text\">{t('source-audio-not-allowed-text')}</Text>\n      </Notification>\n    </Fragment>;\n  } else if (audioUnexpectedEnd === true) {\n    body = <Fragment>\n      <FontAwesomeIcon icon={faExclamationTriangle} size=\"3x\" />\n      <Spacer min=\"16px\" max=\"48px\" />\n      <Notification isDanger>\n        <Text variant=\"text\">{t('error-lost-audio-stream')}</Text>\n      </Notification>\n    </Fragment>;\n  } else {\n    body = <Spinner size=\"75\"/>;\n  }\n\n  return (\n    <Fragment>\n      <Themed.h1>{ t('sources-audio-microphone-selected') }</Themed.h1>\n\n      <div sx={{\n        maxWidth: 850,\n        width: '100%',\n        mx: 'auto',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        flex: '1 0 auto',\n        maxHeight: '400px',\n      }}>{ body }</div>\n\n      <ActionButtons\n        prev={{ label: 'sources-audio-reselect-audio', onClick: reselectSource }}\n        next={{ onClick: enterStudio }}\n      />\n    </Fragment>\n  );\n};\n\nconst OptionButton = ({ children, icon, label, onClick }) => {\n  return (\n    <button\n      onClick={onClick}\n      sx={{\n        fontFamily: 'inherit',\n        color: 'gray.0',\n        backgroundColor: 'gray.4',\n        border: '2px solid black',\n        borderRadius: '8px',\n        flex: '0 1 50%',\n        p: 2,\n        '&:hover': {\n          boxShadow: theme => `0 0 10px ${theme.colors.gray[2]}`,\n          filter: 'brightness(1.2)',\n        },\n      }}\n    >\n      <div sx={{ display: 'block', textAlign: 'center', mb: 3 }}>\n        <FontAwesomeIcon icon={icon} size=\"3x\"/>\n      </div>\n      <div sx={{ fontSize: 4 }}>{label}</div>\n      {children}\n    </button>\n  );\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { useTranslation } from 'react-i18next';\n\n\n// A styled `<input>`` element with a label. Displays errors and integrated with\n// `react-hook-form`.\n//\n// Props:\n// - `errors` and `register`: the two values returned by `useForm`\n// - `label`: the human readable string describing the field\n// - `name`, `type` and `rest`: passed as HTML attributes\n// - `required`: boolean, whether this field is required or may be empty\n// - `validate`: optional, a function validating the value and returning a\n//   string in the case of error.\nexport const Input = ({\n  errors,\n  register,\n  label,\n  name,\n  required,\n  validate,\n  type = 'text',\n  ...rest\n}) => {\n  const { t } = useTranslation();\n\n  return (\n    <div\n      sx={{\n        '&:not(:last-child)': {\n          mb: 3\n        }\n      }}\n    >\n      <label\n        sx={{\n          color: 'text',\n          display: 'block',\n          fontSize: 2,\n          fontWeight: 'bold'\n        }}\n      >\n        {label}\n        <div\n          sx={{\n            display: 'block',\n            boxSizing: 'border-box',\n            clear: 'both',\n            fontSize: 2,\n            position: 'relative',\n            textAlign: 'left'\n          }}\n        >\n          <input\n            aria-invalid={errors[name] ? 'true' : 'false'}\n            aria-describedby={`${name}Error`}\n            autoComplete=\"off\"\n            name={name}\n            ref={register({\n              validate,\n              ...required ? { required: t('forms-validation-error-required') } : {},\n            })}\n            sx={{ variant: 'styles.input' }}\n            type={type}\n            {...rest}\n          />\n          {errors[name] && (\n            <p\n              id={`${name}Error`}\n              sx={{\n                color: 'error',\n                fontSize: 1,\n                fontWeight: 'body',\n                mt: 1\n              }}\n            >\n              {errors[name].message}\n            </p>\n          )}\n        </div>\n      </label>\n    </div>\n  );\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faDownload, faCheckCircle } from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@theme-ui/components';\nimport { useTranslation } from 'react-i18next';\n\nimport { recordingFileName } from '../../../util.js';\n\n\nconst RecordingPreview = ({ onDownload, recording, title, presenter }) => {\n  const { t, i18n } = useTranslation();\n  const { deviceType, mimeType, url, downloaded, media: blob } = recording;\n\n  const flavor = deviceType === 'desktop' ? t('sources-display') : t('sources-user');\n  const downloadName = recordingFileName({ mimeType, flavor, title, presenter });\n\n  if (!url) {\n    return null;\n  }\n\n  // Get file size in human readable format. We use base-1000 XB instead of\n  // base-1024 XiB, as the latter would probably confuse some users and many\n  // file managers use base-1000 anyway. Notably, the windows file manager\n  // calculates with base-1024 but shows \"XB\". So it is lying.\n  const numBytes = blob.size;\n  const round = n => {\n    const digits = n < 10 ? 1 : 0;\n    return n.toLocaleString(i18n.language, {\n      minimumFractionDigits: digits,\n      maximumFractionDigits: digits,\n    });\n  };\n  const prettyFileSize = (() => {\n    if (numBytes < 1000) {\n      return `${numBytes} B`;\n    } else if (numBytes < 999_500) {\n      return `${round(numBytes / 1000)} KB`;\n    } else if (numBytes < 999_500_000) {\n      return `${round(numBytes / (1_000_000))} MB`;\n    } else {\n      return `${round(numBytes / (1_000_000_000))} GB`;\n    }\n  })();\n\n\n  return (\n    <div sx={{\n      display: 'flex',\n      flexDirection: 'column',\n      flex: '0 0 auto',\n      mx: 2,\n      pb: '12px',\n      alignItems: 'center',\n    }}>\n      <div sx={{\n        position: 'relative',\n        height: '150px',\n        border: theme => `2px solid ${theme.colors.gray[1]}`,\n      }}>\n        <video tabIndex={'-1'}\n          muted\n          src={url}\n          // Without this, some browsers show a black video element instead of the first frame.\n          onLoadedData={e => e.target.currentTime = 0}\n          preload=\"auto\"\n          sx={{\n            maxWidth: '100%',\n            height: '100%',\n          }}\n        ></video>\n        { downloaded && (\n          <div sx={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0,\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            color: 'primary',\n            backgroundColor: 'rgba(0, 0, 0, 0.4)',\n          }}>\n            <FontAwesomeIcon icon={faCheckCircle} size=\"4x\" />\n          </div>\n        )}\n      </div>\n      <Button\n        as=\"a\"\n        role=\"button\"\n        sx={{\n          width: '100%',\n          maxWidth: '215px',\n          margin: 'auto',\n          mt: '10px',\n        }}\n        target=\"_blank\"\n        download={downloadName}\n        href={url}\n        rel=\"noopener noreferrer\"\n        onClick={onDownload}\n      >\n        <FontAwesomeIcon icon={faDownload} />\n        {t('save-creation-download-button')}\n        {' '}({ prettyFileSize })\n      </Button>\n    </div>\n  );\n};\n\nexport default RecordingPreview;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Themed, Progress, useColorMode } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faCheckCircle,\n  faUpload,\n  faRedoAlt,\n  faExclamationTriangle,\n  faTimesCircle,\n} from '@fortawesome/free-solid-svg-icons';\nimport { Button, Box, Container, Spinner, Text } from '@theme-ui/components';\nimport { Fragment, useEffect, useRef, useState } from 'react';\nimport { Link, useLocation } from 'react-router-dom';\nimport { Trans, useTranslation } from 'react-i18next';\nimport useForm from 'react-hook-form';\nimport { usePageVisibility } from 'react-page-visibility';\n\nimport {\n  useOpencast,\n  STATE_UNCONFIGURED,\n  STATE_CONNECTED,\n  STATE_NETWORK_ERROR,\n  STATE_INCORRECT_LOGIN,\n  STATE_RESPONSE_NOT_OK,\n  STATE_INVALID_RESPONSE,\n  UPLOAD_SUCCESS,\n  UPLOAD_NETWORK_ERROR,\n  UPLOAD_NOT_AUTHORIZED,\n  UPLOAD_UNEXPECTED_RESPONSE,\n} from '../../../opencast';\nimport { useSettings, FORM_FIELD_HIDDEN, FORM_FIELD_REQUIRED } from '../../../settings';\nimport {\n  useDispatch,\n  useStudioState,\n  STATE_ERROR,\n  STATE_UPLOADING,\n  STATE_UPLOADED,\n  STATE_NOT_UPLOADED,\n} from '../../../studio-state';\n\nimport Notification from '../../notification';\nimport { ActionButtons } from '../elements';\nimport { Input } from '../../elements';\n\nimport RecordingPreview from './recording-preview';\n\nimport { GlobalHotKeys } from 'react-hotkeys';\nimport { otherShortcuts } from '../keyboard-shortcuts/globalKeys';\n\nconst LAST_PRESENTER_KEY = 'ocStudioLastPresenter';\n\nlet progressHistory = [];\n\nexport default function SaveCreation(props) {\n  const settings = useSettings();\n  const { t } = useTranslation();\n  const opencast = useOpencast();\n  const { recordings, upload: uploadState, title, presenter, start, end } = useStudioState();\n  const dispatch = useDispatch();\n\n  function handleBack() {\n    props.previousStep();\n  }\n\n  function onProgress(progress) {\n    // ----- Time estimation -----\n    // We use a simple sliding average over the last few data points and assume\n    // that speed for the rest of the upload.\n    const now = Date.now();\n\n    // Add progress data point to history.\n    progressHistory.push({\n      timestamp: now,\n      progress,\n    });\n\n    // The size of the sliding window in milliseconds.\n    const WINDOW_SIZE_MS = 5000;\n    // The size of the sliding window in number of data points.\n    const WINDOW_SIZE_DATA_POINTS = 6;\n    // The number of datapoints below which we won't show a time estimate.\n    const MINIMUM_DATA_POINT_COUNT = 4;\n\n    // Find the first element within the window. We use the larger window of the\n    // two windows created by the two constraints (time and number of\n    // datapoints).\n    const windowStart = Math.min(\n      progressHistory.findIndex(p => (now - p.timestamp) < WINDOW_SIZE_MS),\n      Math.max(0, progressHistory.length - WINDOW_SIZE_DATA_POINTS),\n    );\n\n    // Remove all elements outside the window.\n    progressHistory.splice(0, windowStart);\n\n    let secondsLeft = null;\n    if (progressHistory.length >= MINIMUM_DATA_POINT_COUNT) {\n      // Calculate the remaining time based on the average speed within the window.\n      const windowLength = now - progressHistory[0].timestamp;\n      const progressInWindow = progress - progressHistory[0].progress;\n      const progressPerSecond = (progressInWindow / windowLength) * 1000;\n      const progressLeft = 1 - progress;\n      secondsLeft = Math.max(0, Math.round(progressLeft / progressPerSecond));\n    }\n\n    // Update state if anything changed. We actually check for equality here to\n    // avoid useless redraws.\n    if (uploadState.secondsLeft !== secondsLeft || uploadState.currentProgress !== progress) {\n      dispatch({\n        type: 'UPLOAD_PROGRESS_UPDATE',\n        payload: { secondsLeft, currentProgress: progress },\n      });\n    }\n  }\n\n  useEffect(() => {\n    // To still update the time estimation, we make sure to call `onProgress` at\n    // least every so often.\n    const interval = setInterval(() => {\n      if (uploadState.state !== STATE_UPLOADING) {\n        return;\n      }\n\n      if (!progressHistory.length) {\n        onProgress(0);\n      } else {\n        const lastProgress = progressHistory[progressHistory.length - 1];\n        const timeSinceLastUpdate = Date.now() - lastProgress.timestamp;\n        if (timeSinceLastUpdate > 3000) {\n          onProgress(lastProgress.progress);\n        }\n      }\n    }, 1000);\n\n    return () => clearInterval(interval);\n  });\n\n  async function handleUpload() {\n    dispatch({ type: 'UPLOAD_REQUEST' });\n    progressHistory.push({\n      timestamp: Date.now(),\n      progress: 0,\n    });\n    const result = await opencast.upload({\n      recordings: recordings.filter(Boolean),\n      title,\n      presenter,\n      start,\n      end,\n      uploadSettings: settings.upload,\n      onProgress,\n    });\n    progressHistory = [];\n\n    switch (result) {\n      case UPLOAD_SUCCESS:\n        dispatch({ type: 'UPLOAD_SUCCESS' });\n        break;\n      case UPLOAD_NETWORK_ERROR:\n        dispatch({ type: 'UPLOAD_ERROR', payload: t('save-creation-upload-network-error') });\n        break;\n      case UPLOAD_NOT_AUTHORIZED:\n        dispatch({ type: 'UPLOAD_ERROR', payload: t('save-creation-upload-not-authorized') });\n        break;\n      case UPLOAD_UNEXPECTED_RESPONSE:\n        dispatch({ type: 'UPLOAD_ERROR', payload: t('save-creation-upload-invalid-response') });\n        break;\n      default: // including UPLOAD_UNKNOWN_ERROR\n        dispatch({ type: 'UPLOAD_ERROR', payload: t('save-creation-upload-unknown-error') });\n    }\n  }\n\n  const allDownloaded = recordings.every(rec => rec.downloaded);\n  const possiblyDone = (uploadState.state === STATE_UPLOADED || allDownloaded)\n    && uploadState.state !== STATE_UPLOADING;\n  const hideBack = uploadState.state !== STATE_NOT_UPLOADED || allDownloaded;\n\n  // Depending on the state, show a different thing in the upload box.\n  const uploadBox = (() => {\n    const showUnconfiguredWarning = uploadState.state === STATE_NOT_UPLOADED\n      && (opencast.getState() === STATE_UNCONFIGURED || opencast.getState() === STATE_CONNECTED);\n    if (showUnconfiguredWarning) {\n      return <ConnectionUnconfiguredWarning />;\n    }\n\n    switch (uploadState.state) {\n      case STATE_UPLOADING:\n        return <UploadProgress\n          currentProgress={uploadState.currentProgress}\n          secondsLeft={uploadState.secondsLeft}\n        />;\n      case STATE_UPLOADED:\n        return <UploadSuccess />;\n      default: // STATE_NOT_UPLOADED or STATE_ERROR\n        return <UploadForm {...{ uploadState, handleUpload }} />;\n    }\n  })();\n\n  return (\n    <Container sx={{ display: 'flex', flexDirection: 'column', flex: '1 0 auto' }}>\n      <Themed.h1 sx={{ textAlign: 'center', fontSize: ['26px', '30px', '32px']}}>\n        { possiblyDone ? t('save-creation-title-done') : t('save-creation-title') }\n      </Themed.h1>\n\n      <div sx={{\n        display: 'flex',\n        flexDirection: ['column', 'column', 'row'],\n        '& > *': {\n          flex: ['0', '0', '1 0 50%'],\n          p: [2, 2, '0 32px'],\n          '&:last-child': {\n            borderLeft: ['none', 'none', theme => `1px solid ${theme.colors.gray[3]}`],\n          },\n        },\n      }}>\n        <div>\n          <Themed.h2\n            sx={{ pb: 1, borderBottom: theme => `1px solid ${theme.colors.gray[2]}` }}\n          >{t('save-creation-subsection-title-upload')}</Themed.h2>\n\n          <div sx={{ margin: 'auto' }}>\n            { uploadBox }\n          </div>\n        </div>\n\n        <div>\n          <Themed.h2\n            sx={{ pb: 1, borderBottom: theme => `1px solid ${theme.colors.gray[2]}` }}\n          >{t('save-creation-subsection-title-download')}</Themed.h2>\n\n          <DownloadBox dispatch={dispatch} {...{ title, presenter }} />\n        </div>\n      </div>\n\n      <div sx={{ flex: '1 0 32px' }}></div>\n\n      <ActionButtons\n        next={null}\n        prev={hideBack ? null : {\n          onClick: handleBack,\n          disabled: false,\n        }}\n      >\n        { possiblyDone && <PostAction\n          goToFirstStep={props.firstStep}\n        />}\n      </ActionButtons>\n    </Container>\n  );\n}\n\nconst PostAction = ({ goToFirstStep }) => {\n  const { t } = useTranslation();\n  const dispatch = useDispatch();\n  const settings = useSettings();\n\n  const handleNewRecording = () => {\n    const doIt = window.confirm(t('save-creation-new-recording-warning'));\n    if (doIt) {\n      dispatch({ type: 'RESET' });\n      goToFirstStep();\n    }\n  };\n\n  let returnAction;\n  if (settings.return?.target) {\n    if (isAllowedReturnTarget(settings)) {\n      const label = settings.return?.label\n        ? t('save-creation-return-to', { label: settings.return.label })\n        : t('save-creation-return-to-no-label');\n\n      returnAction = (\n        <Button\n          as=\"a\"\n          title={label}\n          href={settings.return.target}\n          sx={{ whiteSpace: 'nowrap', fontWeight: 400, mb: 2 }}\n        >\n          <FontAwesomeIcon icon={faTimesCircle} />\n          { label }\n        </Button>\n      );\n    } else {\n      console.warn(\"the given 'return.target' is not allowed \"\n        + \"(check 'return.allowedDomains' in 'settings.toml')\");\n    }\n  }\n\n  const handlers = {\n    NEW_RECORDING: keyEvent => { if(keyEvent) { handleNewRecording(keyEvent); } },\n  };\n\n  return (\n    <GlobalHotKeys keyMap={otherShortcuts} handlers={handlers}>\n      <div sx={{ display: 'flex', flexDirection: 'column' }}>\n        { returnAction }\n\n        <Button\n          sx={{ whiteSpace: 'nowrap' }}\n          title={t('save-creation-new-recording')}\n          onClick={handleNewRecording}\n        >\n          <FontAwesomeIcon icon={faRedoAlt} />\n          {t('save-creation-new-recording')}\n        </Button>\n      </div>\n    </GlobalHotKeys>\n  );\n};\n\nconst isAllowedReturnTarget = settings => {\n  let targetUrl;\n  try {\n    targetUrl = new URL(settings.return.target, window.location);\n  } catch (e) {\n    return false;\n  }\n\n  const allowedDomains = [window.location.hostname, ...(settings.return?.allowedDomains || [])];\n  return allowedDomains.some(domain => targetUrl.hostname === domain)\n    && (targetUrl.protocol === 'https:' || targetUrl.protocol === 'http:');\n};\n\nconst DownloadBox = ({ presenter, title }) => {\n  const { t } = useTranslation();\n  const dispatch = useDispatch();\n  const { recordings, start, end } = useStudioState();\n\n  const handleDownload = () => {\n    var elements = document.querySelectorAll(\"a[href^='blob']\");\n    for (const element of elements) {\n      element.click();\n    }\n  };\n\n  const handlers = {\n    DOWNLOAD: keyEvent => { if(keyEvent) { handleDownload(keyEvent); } },\n  };\n\n  return (\n    <GlobalHotKeys keyMap={otherShortcuts} handlers={handlers}>\n      <Fragment>\n        { (start !== null || end !== null) && (\n          <Notification sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>\n            <FontAwesomeIcon icon={faExclamationTriangle} sx={{ fontSize: '26px', mb: 3 }} />\n            <p sx={{ m: 0 }}>{ t('save-creation-download-cut-warning') }</p>\n          </Notification>\n        )}\n        <div sx={{\n          display: 'flex',\n          flexDirection: 'row',\n          justifyContent: ['center', 'center', 'start'],\n          flexWrap: 'wrap',\n        }}>\n          { recordings.length === 0 ? <Spinner /> : (\n            recordings.map((recording, index) => (\n              <RecordingPreview\n                key={index}\n                recording={recording}\n                presenter={presenter}\n                title={title}\n                onDownload={() => dispatch({ type: 'MARK_DOWNLOADED', payload: index })}\n              />\n            ))\n          )}\n        </div>\n      </Fragment>\n    </GlobalHotKeys>\n  );\n};\n\n// Shown if there is no working Opencast connection. Shows a warning and a link\n// to settings.\nconst ConnectionUnconfiguredWarning = () => {\n  const location = useLocation();\n  const [colorMode] = useColorMode();\n\n  return (\n    <Notification key=\"opencast-connection\" isDanger>\n      <Trans i18nKey=\"warning-missing-connection-settings\">\n        Warning.\n        <Link\n          to={{ pathname: \"/settings\", search: location.search }}\n          sx={{ variant: 'styles.a', color: colorMode === 'dark' ? 'rgba(255, 255, 34, 0.8)' : '#ff2' }}\n        >\n          settings\n        </Link>\n      </Trans>\n    </Notification>\n  );\n};\n\nconst UploadForm = ({ uploadState, handleUpload }) => {\n  const {\n    titleField = FORM_FIELD_REQUIRED,\n    presenterField = FORM_FIELD_REQUIRED,\n  } = useSettings().upload || {};\n\n  const { t } = useTranslation();\n  const opencast = useOpencast();\n  const dispatch = useDispatch();\n  const { recordings, title, presenter } = useStudioState();\n  const presenterValue = presenter || window.localStorage.getItem(LAST_PRESENTER_KEY) || '';\n\n  const { errors, handleSubmit, register } = useForm();\n\n  // This is a bit ugly, but works. We want to make sure that the `title` and\n  // `presenter` values in the studio state always equal the current value in\n  // the input.\n  function handleInputChange(event) {\n    const target = event.target;\n    dispatch({\n      type: { title: 'UPDATE_TITLE', presenter: 'UPDATE_PRESENTER' }[target.name],\n      payload: target.value,\n    });\n\n    if (target.name === 'presenter') {\n      window.localStorage.setItem(LAST_PRESENTER_KEY, target.value);\n    }\n  }\n\n  // If the user has not yet changed the value of the field and the last used\n  // presenter name is used in local storage, use that.\n  useEffect(() => {\n    if (presenterValue !== presenter) {\n      dispatch({ type: 'UPDATE_PRESENTER', payload: presenterValue });\n    }\n  });\n\n  const buttonLabel = !opencast.prettyServerUrl()\n    ? t('save-creation-button-upload')\n    : (\n      <Trans i18nKey=\"save-creation-upload-to\">\n        Upload to <code sx={{\n          backgroundColor: 'rgba(0, 0, 0, 0.1)',\n          borderRadius: '5px',\n          padding: '1px 3px',\n        }}>{{ server: opencast.prettyServerUrl() }}</code>\n      </Trans>\n    );\n\n  const uploadRef = useRef(null);\n\n  const handlers = {\n    UPLOAD: keyEvent => { if(keyEvent) { uploadRef.current?.click(); } },\n  };\n\n  return (\n    <GlobalHotKeys keyMap={otherShortcuts} handlers={handlers}>\n      <Fragment>\n        <NotConnectedWarning />\n\n        <form>\n          { titleField !== FORM_FIELD_HIDDEN && <Input\n            name=\"title\"\n            label={t('save-creation-label-title')}\n            required={titleField === FORM_FIELD_REQUIRED}\n            onChange={handleInputChange}\n            autoComplete=\"off\"\n            defaultValue={title}\n            {...{ errors, register }}\n          /> }\n\n          { presenterField !== FORM_FIELD_HIDDEN && <Input\n            name=\"presenter\"\n            label={t('save-creation-label-presenter')}\n            required={presenterField === FORM_FIELD_REQUIRED}\n            onChange={handleInputChange}\n            autoComplete=\"off\"\n            defaultValue={presenterValue}\n            {...{ errors, register }}\n          /> }\n\n          <Button\n            disabled={recordings.length === 0}\n            onClick={handleSubmit(handleUpload)}\n            ref={uploadRef}\n          >\n            <FontAwesomeIcon icon={faUpload} />\n            { buttonLabel }\n          </Button>\n        </form>\n\n        <Box sx={{ mt: 2 }}>\n          { uploadState.state === STATE_ERROR && (\n            <Notification isDanger>{uploadState.error}</Notification>\n          )}\n        </Box>\n      </Fragment>\n    </GlobalHotKeys>\n  );\n};\n\nconst NotConnectedWarning = () => {\n  const location = useLocation();\n  const opencast = useOpencast();\n  const { t } = useTranslation();\n  const isVisible = usePageVisibility();\n\n  // In an error state, we are retrying every 5 seconds. We only busy poll if\n  // the page is actually active to not waste resources.\n  const [retrying, setRetrying] = useState(false);\n  useEffect(() => {\n    if (!opencast.isReadyToUpload() && !retrying && isVisible) {\n      const id = setTimeout(async() => {\n        setRetrying(true);\n        await opencast.refreshConnection();\n        setRetrying(false);\n      }, 5000);\n\n      return () => clearTimeout(id);\n    }\n  });\n\n  // If the connection is established, we don't show the warning.\n  if (opencast.isReadyToUpload()) {\n    return null;\n  }\n\n  // Piece together the warning message depending on the situation.\n  let problem;\n  let onceResolved;\n  switch (opencast.getState()) {\n    case STATE_NETWORK_ERROR:\n      problem = t('save-creation-warn-unreachable');\n      onceResolved = t('save-creation-warn-once-reestablished');\n      break;\n    case STATE_INCORRECT_LOGIN:\n      if (opencast.isLoginProvided()) {\n        const referrer = document.referrer;\n        problem = (\n          <Trans i18nKey=\"save-creation-warn-session-expired\">\n            Foo\n            {\n              (referrer && !referrer.includes(window.origin || ''))\n                ? <Themed.a href={referrer} target=\"_blank\" sx={{ color: '#ff2' }}>bar</Themed.a>\n                : <Fragment>bar</Fragment>\n            }\n            baz\n          </Trans>\n        );\n        t('save-creation-warn-session-expired');\n        onceResolved = t('save-creation-warn-once-refreshed');\n      } else {\n        problem = (\n          <Trans i18nKey=\"save-creation-warn-login-failed\">\n            Failed.\n            <Link\n              to={{ pathname: \"/settings\", search: location.search }}\n              sx={{ variant: 'styles.a', color: '#ff2' }}\n            >\n              settings\n            </Link>\n          </Trans>\n        );\n        onceResolved = t('save-creation-warn-once-logged-in');\n      }\n      break;\n    case STATE_RESPONSE_NOT_OK:\n    case STATE_INVALID_RESPONSE:\n      problem = t('save-creation-warn-server-problem')\n        + ' ' + t('save-creation-warn-download-hint');\n      break;\n    default:\n      problem = 'Internal error :-(';\n  }\n\n  return (\n    <Notification isDanger>\n      <div sx={{ textAlign: 'center', fontSize: '40px', lineHeight: 1.3 }}>\n        { retrying\n          ? <Spinner size=\"40\" />\n          : <FontAwesomeIcon icon={faExclamationTriangle} />\n        }\n      </div>\n      <p sx={{ mb: 0 }}>{ problem }</p>\n      { onceResolved && (\n        <p sx={{ mb: 0 }}>\n          { onceResolved }\n          { onceResolved && ' ' }\n          { t('save-creation-warn-download-hint') }\n        </p>\n      )}\n    </Notification>\n  );\n};\n\n// Shown during upload. Shows a progressbar, the percentage of data already\n// uploaded and `secondsLeft` nicely formatted as human readable time.\nconst UploadProgress = ({ currentProgress, secondsLeft }) => {\n  const { t, i18n } = useTranslation();\n\n  // Progress as percent with one fractional digit, e.g. 27.3%.\n  const roundedPercent = Math.min(100, currentProgress * 100).toLocaleString(i18n.language, {\n    minimumFractionDigits: 1,\n    maximumFractionDigits: 1,\n  });\n\n  // Nicely format the remaining time.\n  let prettyTime;\n  if (secondsLeft === null) {\n    prettyTime = null;\n  } else if (secondsLeft < 4) {\n    prettyTime = t('upload-time-a-few-seconds');\n  } else if (secondsLeft < 45) {\n    prettyTime = `${secondsLeft} ${t('upload-time-seconds')}`;\n  } else if (secondsLeft < 90) {\n    prettyTime = t('upload-time-a-minute');\n  } else if (secondsLeft < 45 * 60) {\n    prettyTime = `${Math.round(secondsLeft / 60)} ${t('upload-time-minutes')}`;\n  } else if (secondsLeft < 90 * 60) {\n    prettyTime = t('upload-time-an-hour');\n  } else if (secondsLeft < 24 * 60 * 60) {\n    prettyTime = `${Math.round(secondsLeft / (60 * 60))} ${t('upload-time-hours')}`;\n  } else {\n    prettyTime = null;\n  }\n\n  return (\n    <Fragment>\n      <div sx={{ display: 'flex', mb: 2 }}>\n        <Text variant=\"text\">{roundedPercent}%</Text>\n        <div sx={{ flex: 1 }} />\n        <Text variant=\"text\">\n          {prettyTime && <Trans i18nKey=\"upload-time-left\">\n            {{ time: prettyTime }} left\n          </Trans>}\n        </Text>\n      </div>\n      <Progress max={1} value={currentProgress} variant=\"styles.progress\">\n        { roundedPercent }\n      </Progress>\n      <Text variant=\"text\" sx={{ textAlign: 'center', mt: 2 }}>{t('upload-notification')}</Text>\n    </Fragment>\n  );\n};\n\n// Shown if the upload was successful. A big green checkmark and a text.\nconst UploadSuccess = () => {\n  const { t } = useTranslation();\n\n  return (\n    <Fragment>\n      <div sx={{\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        height: '130px',\n        color: 'primary',\n      }}>\n        <FontAwesomeIcon icon={faCheckCircle} size=\"4x\" />\n      </div>\n      <Text variant=\"text\" sx={{ textAlign: 'center' }}>{t('message-upload-complete')}</Text>\n      <Text sx={{ textAlign: 'center', mt: 2 }}>{t('message-upload-complete-explanation')}</Text>\n    </Fragment>\n  );\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport Tippy from '@tippyjs/react';\nimport 'tippy.js/dist/tippy.css';\nimport './style/global-style';\n\nconst Tooltip = ({ content, ...props }) => (\n\n  <Tippy\n    content = { <span> {content} </span> }\n    interactive={true}\n\n    sx={{\n      fontSize: '16px',\n      backgroundColor: theme => theme.colors.tooltip,\n      color: theme => theme.colors.tooltip_text,\n      lineHeight: 'normal',\n      fontFamily: 'Open Sans',\n    }}\n\n    {...props}\n  >\n    <span> {props.children} </span>\n  </Tippy>\n);\n\nexport default Tooltip;\n","// Everything related to video stream preferences that the user can modify.\n\n//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, useColorMode } from 'theme-ui';\n\nimport { Fragment, useEffect, useState } from 'react';\nimport { useTranslation, Trans } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes, faCog } from '@fortawesome/free-solid-svg-icons';\nimport useResizeObserver from 'use-resize-observer/polyfilled';\n\nimport { useSettings } from '../../../settings';\nimport { dimensionsOf, getUniqueDevices } from '../../../util';\nimport { useDispatch, useStudioState } from '../../../studio-state';\nimport {\n  startDisplayCapture,\n  startUserCapture,\n  stopDisplayCapture,\n  stopUserCapture\n} from '../capturer';\nimport Tooltip from '../../../Tooltip';\n\n\n// Creates a valid constraints object from the given preferences. The mapping\n// is as follows:\n//\n// - deviceId: falsy values are ignored, any other value is passed on, either as\n//   `ideal` (if `exactDevice` is `false`) or `exact` (if `exactDevice` is\n//   `true`).\n// - aspectRatio: values in `ASPECT_RATIOS` are passed as `ideal`, everything\n//   else is ignored.\n// - quality: valid quality labels are passed on as `ideal` height, invalid ones\n//   are ignored.\nexport const prefsToConstraints = (prefs, exactDevice = false) => {\n  const deviceConstraint = prefs.deviceId\n    && { deviceId: { [exactDevice ? 'exact' : 'ideal']: prefs.deviceId }};\n\n  const aspectRatio = parseAspectRatio(prefs.aspectRatio);\n  const aspectRatioConstraint = aspectRatio && { aspectRatio: { ideal: aspectRatio }};\n\n  const height = parseQuality(prefs.quality);\n  const heightConstraint = height && { height: { ideal: height }};\n\n  return {\n    ...deviceConstraint,\n    ...aspectRatioConstraint,\n    ...heightConstraint,\n  };\n};\n\n// All aspect ratios the user can choose from.\nconst ASPECT_RATIOS = ['4:3', '16:9'];\n\n// All quality options given to the user respecting the `maxHeight` from the\n// settings.\nconst qualityOptions = maxHeight => {\n  const defaults = [360, 480, 720, 1080, 1440, 2160];\n  let out = defaults.filter(q => !maxHeight || q <= maxHeight);\n  if (maxHeight && (out.length === 0 || out[out.length - 1] !== maxHeight)) {\n    out.push(maxHeight);\n  }\n\n  return out.map(n => `${n}p`);\n};\n\n// Converts the given aspect ratio label (one of the elements in\n// `ASPECT_RATIOS`) into the numerical ratio, e.g. 4/3 = 1.333. If the argument\n// is not a valid label, `null` is returned.\nconst parseAspectRatio = label => {\n  const mapping = {\n    '4:3': 4 / 3,\n    '16:9': 16 / 9,\n  };\n\n  return mapping[label] || null;\n};\n\n// Converts the given quality label to the actual height as number. If the\n// argument is not a valid quality label (e.g. '720p'), `null` is returned.\nconst parseQuality = label => {\n  if (!/^[0-9]+p$/.test(label)) {\n    return null;\n  }\n\n  return parseInt(label);\n};\n\n// Local storage keys\nconst LAST_VIDEO_DEVICE_KEY = 'ocStudioLastVideoDevice';\nconst CAMERA_ASPECT_RATIO_KEY = 'ocStudioCameraAspectRatio';\nconst CAMERA_QUALITY_KEY = 'ocStudioCameraQuality';\nconst DISPLAY_QUALITY_KEY = 'ocStudioDisplayQuality';\n\n// Loads the initial camera preferences from local storage.\nexport const loadCameraPrefs = () => ({\n  deviceId: window.localStorage.getItem(LAST_VIDEO_DEVICE_KEY),\n  aspectRatio: window.localStorage.getItem(CAMERA_ASPECT_RATIO_KEY) || 'auto',\n  quality: window.localStorage.getItem(CAMERA_QUALITY_KEY) || 'auto',\n});\n\n// Loads the initial display preferences from local storage.\nexport const loadDisplayPrefs = () => ({\n  quality: window.localStorage.getItem(DISPLAY_QUALITY_KEY) || 'auto',\n});\n\n\nexport const StreamSettings = ({ isDesktop, stream }) => {\n  const dispatch = useDispatch();\n  const settings = useSettings();\n  const [expandedHeight, setExpandedHeight] = useState(0);\n  const { ref } = useResizeObserver({\n    // We don't use the height passed to the callback as we want the outer\n    // height. We also add a magic \"4\" here. 2 pixels are for the border of the\n    // outer div. The other two are \"wiggle room\". If we always set the height\n    // to fit exactly, this easily leads to unnessecary scrollbars appearing.\n    // This in turn might lead to rewrapping and then a change in height, in\n    // the worst case ending up in an infinite loop.\n    onResize: () => setExpandedHeight(ref.current?.offsetHeight + 4),\n  });\n  const { t } = useTranslation();\n\n  // The current preferences and the callback to update them.\n  const prefs = isDesktop ? loadDisplayPrefs() : loadCameraPrefs();\n  const updatePrefs = newPrefs => {\n    // Merge and update preferences.\n    const merged = { ...prefs, ...newPrefs };\n    const constraints = prefsToConstraints(merged, true);\n\n    // Update preferences in local storage and re-request stream. The latter\n    // will cause the rerender.\n    if (isDesktop) {\n      window.localStorage.setItem(DISPLAY_QUALITY_KEY, merged.quality);\n\n      stopDisplayCapture(stream, dispatch);\n      startDisplayCapture(dispatch, settings, constraints);\n    } else {\n      window.localStorage.setItem(LAST_VIDEO_DEVICE_KEY, merged.deviceId);\n      window.localStorage.setItem(CAMERA_ASPECT_RATIO_KEY, merged.aspectRatio);\n      window.localStorage.setItem(CAMERA_QUALITY_KEY, merged.quality);\n\n      stopUserCapture(stream, dispatch);\n      startUserCapture(dispatch, settings, constraints);\n    }\n  };\n\n  // Store the camera device ID in local storage. We also do this here, as we\n  // also want to remember the device the user initially selected in the browser\n  // popup.\n  useEffect(() => {\n    const cameraDeviceId = deviceIdOf(stream);\n    if (!isDesktop && cameraDeviceId) {\n      window.localStorage.setItem(LAST_VIDEO_DEVICE_KEY, cameraDeviceId);\n    }\n  });\n\n  // State about expanding and hiding the settings.\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [colorMode] = useColorMode();\n\n  return <Fragment>\n    <div sx={{\n      position: 'absolute',\n      top: isExpanded ? '8px' : '-30px',\n      left: 0,\n      right: 0,\n      textAlign: 'center',\n      transition: 'top 0.2s',\n    }}>\n      <span sx={{\n        color: colorMode === 'dark' ? 'gray.3' : 'gray.1',\n        backgroundColor: 'white',\n        borderRadius: '10px',\n        p: 1,\n        fontSize: '18px',\n      }}>\n        <StreamInfo stream={stream} />\n      </span>\n    </div>\n    <div sx={{\n      position: 'absolute',\n      left: 0,\n      right: 0,\n      bottom: 0,\n      height: '100%',\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'flex-end',\n    }}>\n      <div sx={{ textAlign: 'right' }}>\n        <Tooltip offset={[0, 25]} content={isExpanded ? t('video-settings-close') : t('video-settings-open') }>\n          <button\n            onClick={() => setIsExpanded(old => !old)}\n            sx={{\n              border: 'none',\n              display: 'inline-block',\n              backgroundColor: 'rgba(0, 0, 0, 0.5)',\n              color: 'white',\n              p: '6px',\n              m: 2,\n              fontSize: '30px',\n              lineHeight: '1em',\n              borderRadius: '10px',\n              cursor: 'pointer',\n              '&:hover': {\n                backgroundColor: 'rgba(0, 0, 0, 0.7)',\n              },\n              '&:hover > svg, &:focus > svg': {\n                transform: isExpanded ? 'none' : 'rotate(45deg)',\n              },\n              '&:focus-visible': {\n                outline: theme => `5px solid ${theme.colors.primary}`,\n                outlineOffset: '-2px',\n                backgroundColor: 'rgba(0, 0, 0, 0.7)',\n                color: 'white',\n              },\n            }}\n          >\n            <FontAwesomeIcon\n              icon={isExpanded ? faTimes : faCog}\n              fixedWidth\n              sx={{\n                transition: isExpanded ? 'none' : 'transform 0.2s',\n                width: '1em !important',\n              }}\n            />\n          </button>\n        </Tooltip>\n      </div>\n      <div sx={{\n        height: isExpanded ? (expandedHeight || 'auto') : 0,\n        flex: '0 1 auto',\n        transition: 'height 0.2s',\n        overflow: 'hidden',\n        backgroundColor: 'background',\n        fontSize: '18px',\n        boxShadow: isExpanded ? '0 0 15px rgba(0, 0, 0, 0.3)' : 'none',\n      }}>\n        <div tabIndex={'-1'} sx={{\n          border: theme => `1px solid ${theme.colors.gray[0]}`,\n          height: '100%',\n          overflow: 'auto',\n        }}>\n          <div ref={ref} sx={{ p: 1, pb: '2px', }}>\n            <div sx={{\n              display: 'grid',\n              width: '100%',\n              gridTemplateColumns: 'auto 1fr',\n              gridGap: '6px 12px',\n              p: 1,\n            }} >\n              { !isDesktop && <UserSettings {...{ updatePrefs, prefs, isExpanded }} /> }\n              <UniveralSettings {...{ isDesktop, updatePrefs, prefs, stream, settings, isExpanded }} />\n            </div>\n\n            <div sx={{\n              backgroundColor: 'gray.4',\n              m: 2,\n              py: 1,\n              px: 2,\n              fontSize: '16px',\n              lineHeight: '20px',\n              border: theme => `1px solid ${theme.colors.gray[2]}`,\n            }}>\n              <Trans i18nKey=\"sources-video-preferences-note\">\n                <strong>Note:</strong> Explanation.\n              </Trans>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Fragment>;\n};\n\nconst StreamInfo = ({ stream }) => {\n  const s = stream?.getVideoTracks()?.[0]?.getSettings();\n  const sizeInfo = (s && s.width && s.height) ? `${s.width}×${s.height}` : '';\n  const fpsInfo = (s && s.frameRate) ? `${s.frameRate} fps` : '';\n\n  return s ? [sizeInfo, fpsInfo].join(', ') : '...';\n};\n\nconst PrefKey = ({ children }) => (\n  <div sx={{\n    gridColumn: '0 1',\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    hyphens: 'auto',\n  }}>\n    { children }\n  </div>\n);\nconst PrefValue = ({ children }) => (\n  <div tabIndex={-1}\n    sx={{\n      gridColumn: '1 2',\n      overflowX: 'auto',\n      lineHeight: '30px',\n      '*:focus-visible': {\n        outline: theme => `5px solid ${theme.colors.primary}`,\n        outlineOffset: '-3px',\n      }\n    }}>\n    { children }\n  </div>\n);\n\nconst UniveralSettings = ({ isDesktop, updatePrefs, prefs, stream, settings, isExpanded }) => {\n  const { t } = useTranslation();\n\n  const changeQuality = quality => updatePrefs({ quality });\n  const maxHeight = isDesktop ? settings.display?.maxHeight : settings.camera?.maxHeight;\n  const qualities = qualityOptions(maxHeight);\n  const kind = isDesktop ? 'desktop' : 'user';\n\n  const [, currentHeight] = dimensionsOf(stream);\n  let fitState;\n  if (currentHeight && qualities.includes(prefs.quality)) {\n    const expectedHeight = parseInt(prefs.quality);\n    fitState = expectedHeight === currentHeight ? 'ok' : 'warn';\n  }\n\n  return <Fragment>\n    <PrefKey>{t('sources-video-quality')}*:</PrefKey>\n    <PrefValue>\n      <RadioButton\n        isExpanded={isExpanded}\n        id={`quality-auto-${kind}`}\n        value=\"auto\"\n        name={`quality-${kind}`}\n        label={t('sources-video-quality-auto')}\n        onChange={changeQuality}\n        checked={qualities.every(q => prefs.quality !== q)}\n      />\n      {\n        qualities.map(q => <Fragment key={`${q}-${kind}`}>\n          <wbr />\n          <RadioButton\n            isExpanded={isExpanded}\n            id={`quality-${q}-${kind}`}\n            value={q}\n            name={`quality-${kind}`}\n            onChange={changeQuality}\n            checked={prefs.quality === q}\n            state={fitState}\n          />\n        </Fragment>)\n      }\n    </PrefValue>\n  </Fragment>;\n};\n\nconst UserSettings = ({ updatePrefs, prefs, isExpanded }) => {\n  const { t } = useTranslation();\n  const state = useStudioState();\n\n  const currentDeviceId = deviceIdOf(state.userStream);\n  const devices = getUniqueDevices(state.mediaDevices, 'videoinput');\n\n  const [width, height] = dimensionsOf(state.userStream);\n  let arState;\n  if (width && height && ASPECT_RATIOS.includes(prefs.aspectRatio)) {\n    const currentAr = width / height;\n    const expectedAr = parseAspectRatio(prefs.aspectRatio);\n\n    // We have some range we accept as \"good\". You never know with these\n    // floats...\n    arState = (expectedAr * 0.97 < currentAr && currentAr < expectedAr / 0.97)\n      ? 'ok'\n      : 'warn';\n  }\n\n  const changeDevice = id => updatePrefs({ deviceId: id });\n  const changeAspectRatio = ratio => updatePrefs({ aspectRatio: ratio });\n\n  return <Fragment>\n    <PrefKey>\n      <label htmlFor=\"sources-video-device\">{t('sources-video-device')}:</label>\n    </PrefKey>\n    <PrefValue>\n      <select\n        id=\"sources-video-device\"\n        tabIndex={isExpanded ? '0' : '-1'}\n        sx={{ variant: 'styles.select' }}\n        value={currentDeviceId}\n        onChange={e => changeDevice(e.target.value)}\n      >\n        {\n          devices.map((d, i) => (\n            <option key={i} value={d.deviceId}>{ d.label }</option>\n          ))\n        }\n      </select>\n    </PrefValue>\n\n    <PrefKey>{t('sources-video-aspect-ratio')}*:</PrefKey>\n    <PrefValue>\n      <RadioButton\n        isExpanded={isExpanded}\n        id=\"ar-auto\"\n        value=\"auto\"\n        name=\"aspectRatio\"\n        label={t('sources-video-aspect-ratio-auto')}\n        onChange={changeAspectRatio}\n        checked={ASPECT_RATIOS.every(x => prefs.aspectRatio !== x)}\n      />\n      {\n        ASPECT_RATIOS.map(ar => <Fragment key={`ar-${ar}`}>\n          <wbr />\n          <RadioButton\n            isExpanded={isExpanded}\n            id={`ar-${ar}`}\n            value={ar}\n            name=\"aspectRatio\"\n            onChange={changeAspectRatio}\n            checked={prefs.aspectRatio === ar}\n            state={arState}\n          />\n        </Fragment>)\n      }\n    </PrefValue>\n  </Fragment>;\n};\n\n// A styled radio input which looks like a button.\nconst RadioButton = ({ id, value, checked, name, onChange, label, isExpanded }) => {\n\n  return <Fragment>\n    <input\n      type=\"radio\"\n      onChange={e => onChange(e.target.value)}\n      {...{ id, value, checked, name }}\n      sx={{\n        display: 'none',\n        '&+label': {\n          border: theme => `2px solid ${theme.colors.gray[0]}`,\n          p: '1px 4px',\n          borderRadius: '6px',\n          mx: 1,\n        },\n        '&:checked+label': {\n          bg: 'gray.0',\n          color: 'background',\n          fontWeight: 'bold',\n        }\n      }}\n    />\n    <label\n      tabIndex={isExpanded ? '0' : '-1'}\n      onKeyDown={e => (e.key === 'Enter' || e.key === ' ' ) && onChange(value)}\n      htmlFor={id}\n    >{ label || value }</label>\n  </Fragment>;\n};\n\n// Returns the devide ID of the video track of the given stream.\nexport const deviceIdOf = stream => stream?.getVideoTracks()?.[0]?.getSettings()?.deviceId;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { Fragment, useEffect, useRef } from 'react';\nimport { Card, Spinner } from '@theme-ui/components';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faExclamationTriangle } from '@fortawesome/free-solid-svg-icons';\n\nimport { VideoBox, useVideoBoxResize } from '../elements.js';\nimport { dimensionsOf } from '../../../util.js';\nimport { StreamSettings } from './prefs';\n\n\n// Shows the preview for one or two input streams. The previews also show\n// preferences allowing the user to change the webcam and the like.\nexport const SourcePreview = ({ warnings, inputs }) => {\n  let children;\n  switch (inputs.length) {\n    case 1:\n      children = [{\n        body: <StreamPreview input={inputs[0]} />,\n        dimensions: () => dimensionsOf(inputs[0].stream),\n      }];\n      break;\n    case 2:\n      children = [\n        {\n          body: <StreamPreview input={inputs[0]} />,\n          dimensions: () => dimensionsOf(inputs[0].stream),\n        },\n        {\n          body: <StreamPreview input={inputs[1]} />,\n          dimensions: () => dimensionsOf(inputs[1].stream),\n        },\n      ];\n      break;\n    default:\n      return <p>Something went very wrong</p>;\n  }\n\n  // Below this value, the video preference menu looks awful.\n  const minWidth = 300;\n\n  return (\n    <Fragment>\n      { warnings }\n      <VideoBox minWidth={minWidth} gap={20}>{ children }</VideoBox>\n    </Fragment>\n  );\n};\n\nconst StreamPreview = ({ input, text }) => (\n  <Card sx={{ height: '100%', overflow: 'hidden', backgroundColor: 'element_bg' }}>\n    <PreviewVideo input={input} />\n    <StreamSettings isDesktop={input.isDesktop} stream={input.stream} />\n  </Card>\n);\n\nconst PreviewVideo = ({ input }) => {\n  const { allowed, stream, unexpectedEnd } = input;\n  const resizeVideoBox = useVideoBoxResize();\n\n  const videoRef = useRef();\n  useEffect(() => {\n    const v = videoRef.current;\n    if (v) {\n      if (!v.srcObject) {\n        v.srcObject = stream;\n      }\n      v.addEventListener('resize', resizeVideoBox);\n    }\n\n    return () => {\n      if (v) {\n        v.removeEventListener('resize', resizeVideoBox);\n      }\n    };\n  }, [stream, resizeVideoBox]);\n\n  if (!stream) {\n    let inner;\n    if (allowed === false || unexpectedEnd) {\n      inner = <FontAwesomeIcon icon={faExclamationTriangle} size=\"3x\" />;\n    } else {\n      inner = <Spinner size=\"75\"/>;\n    }\n\n    return (\n      <div tabIndex={'-1'}\n        sx={{\n          width: '100%',\n          height: '100%',\n          minHeight: '120px',\n          display: 'flex',\n          justifyContent: 'center',\n          alignItems: 'center',\n        }}\n      >\n        { inner }\n      </div>\n    );\n  }\n\n  return (\n    <video tabIndex={'-1'}\n      ref={videoRef}\n      autoPlay\n      muted\n      sx={{\n        minHeight: 0,\n        display: 'block',\n        width: '100%',\n        height: '100%',\n        // TODO: (mel) research this setting\n        // transform: 'rotateY(180deg)'\n      }}\n    />\n  );\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Themed } from 'theme-ui';\n\nimport { faChalkboard, faChalkboardTeacher, faUser } from '@fortawesome/free-solid-svg-icons';\nimport { Flex, Heading, Text } from '@theme-ui/components';\nimport React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport {\n  useDispatch,\n  useStudioState,\n  VIDEO_SOURCE_BOTH,\n  VIDEO_SOURCE_DISPLAY,\n  VIDEO_SOURCE_USER,\n  VIDEO_SOURCE_NONE,\n} from '../../../studio-state';\nimport { useSettings } from '../../../settings';\n\nimport { queryMediaDevices, onMobileDevice } from '../../../util';\nimport Notification from '../../notification';\n\nimport {\n  startDisplayCapture,\n  startUserCapture,\n  stopDisplayCapture,\n  stopUserCapture\n} from '../capturer';\nimport { ActionButtons, StepContainer } from '../elements';\nimport { SourcePreview } from './preview';\nimport { loadCameraPrefs, loadDisplayPrefs, prefsToConstraints } from './prefs';\n\nimport { GlobalHotKeys } from 'react-hotkeys';\nimport { recordShortcuts } from '../keyboard-shortcuts/globalKeys';\n\nexport default function VideoSetup({ nextStep, userHasWebcam }) {\n  const { t } = useTranslation();\n\n  const dispatch = useDispatch();\n  const state = useStudioState();\n  const { displayStream, userStream, videoChoice: activeSource } = state;\n  const hasStreams = displayStream || userStream;\n\n  const setActiveSource = s => dispatch({ type: 'CHOOSE_VIDEO', payload: s });\n  const reselectSource = () => {\n    setActiveSource(VIDEO_SOURCE_NONE);\n    stopUserCapture(userStream, dispatch);\n    stopDisplayCapture(displayStream, dispatch);\n  };\n\n  const nextDisabled = activeSource === VIDEO_SOURCE_NONE\n    || activeSource === VIDEO_SOURCE_BOTH ? (!displayStream || !userStream) : !hasStreams;\n\n  // The warnings if we are not allowed to capture a stream.\n  const userWarning = (state.userAllowed === false) && (\n    <Notification key=\"user-stream-warning\" isDanger>\n      <Heading as=\"h3\" mb={2}>\n        {t('source-user-not-allowed-title')}\n      </Heading>\n      <Text>{t('source-user-not-allowed-text')}</Text>\n    </Notification>\n  );\n  const displayWarning = (state.displayAllowed === false) && (\n    <Notification key=\"display-stream-warning\" isDanger>\n      <Heading as=\"h3\" mb={2}>\n        {t('source-display-not-allowed-title')}\n      </Heading>\n      <Text>{t('source-display-not-allowed-text')}</Text>\n    </Notification>\n  );\n  const unexpectedEndWarning = (state.userUnexpectedEnd || state.displayUnexpectedEnd) && (\n    <Notification key=\"unexpexted-stream-end-warning\" isDanger>\n      <Text>{t('error-lost-video-stream')}</Text>\n    </Notification>\n  );\n\n  const userInput = {\n    isDesktop: false,\n    stream: userStream,\n    allowed: state.userAllowed,\n    unexpectedEnd: state.userUnexpectedEnd,\n  };\n  const displayInput = {\n    isDesktop: true,\n    stream: displayStream,\n    allowed: state.displayAllowed,\n    unexpectedEnd: state.displayUnexpectedEnd,\n  };\n\n  // The body depends on which source is currently selected.\n  let hideActionButtons;\n  let title;\n  let body;\n  switch (activeSource) {\n    case VIDEO_SOURCE_NONE:\n      const userConstraints = prefsToConstraints(loadCameraPrefs());\n      const displayConstraints = prefsToConstraints(loadDisplayPrefs());\n      title = t('sources-video-question');\n      hideActionButtons = true;\n      body = <SourceSelection {...{\n        setActiveSource,\n        userConstraints,\n        displayConstraints,\n        userHasWebcam,\n      }} />;\n      break;\n\n    case VIDEO_SOURCE_USER:\n      title = t('sources-video-user-selected');\n      hideActionButtons = !userStream && state.userAllowed !== false;\n      body = <SourcePreview\n        warnings={[userWarning, unexpectedEndWarning]}\n        inputs={[userInput]}\n      />;\n      break;\n\n    case VIDEO_SOURCE_DISPLAY:\n      title = t('sources-video-display-selected');\n      hideActionButtons = !displayStream && state.displayAllowed !== false;\n      body = <SourcePreview\n        warnings={[displayWarning, unexpectedEndWarning]}\n        inputs={[displayInput]}\n      />;\n      break;\n\n    case VIDEO_SOURCE_BOTH:\n      title = t('sources-video-display-and-user-selected');\n      hideActionButtons = (!userStream && state.userAllowed !== false)\n        || (!displayStream && state.displayAllowed !== false);\n      body = <SourcePreview\n        warnings={[displayWarning, userWarning, unexpectedEndWarning]}\n        inputs={[displayInput, userInput]}\n      />;\n      break;\n    default:\n      console.error('bug: active source has an unexpected value');\n      return <p>Something went very wrong (internal error) :-(</p>;\n  };\n\n  const hideReselectSource = hideActionButtons\n    && !state.userUnexpectedEnd && !state.displayUnexpectedEnd;\n\n  return (\n    <StepContainer>\n      <Themed.h1>{ title }</Themed.h1>\n\n      { body }\n\n      { activeSource !== VIDEO_SOURCE_NONE && <div sx={{ mb: 3 }} /> }\n\n      { activeSource !== VIDEO_SOURCE_NONE && <ActionButtons\n        next={hideActionButtons ? null : { onClick: () => nextStep(), disabled: nextDisabled }}\n        prev={hideReselectSource ? null : {\n          onClick: reselectSource,\n          disabled: false,\n          label: 'sources-video-reselect-source',\n        }}\n      /> }\n    </StepContainer>\n  );\n}\n\nconst SourceSelection = ({ setActiveSource, userConstraints, displayConstraints, userHasWebcam }) => {\n  const { t } = useTranslation();\n\n  const settings = useSettings();\n  const dispatch = useDispatch();\n  const state = useStudioState();\n  const { displaySupported, userSupported } = state;\n\n  const handlers = {\n    RECORD_DISPLAY: keyEvent => { if(keyEvent) { clickDisplay(keyEvent); } },\n    RECORD_CAMERA: keyEvent => { if(keyEvent) { clickUser(keyEvent); } },\n    RECORD_DISPLAY_CAMERA: keyEvent => { if(keyEvent) { clickBoth(keyEvent); } },\n  };\n\n  const clickUser = async() => {\n    setActiveSource(VIDEO_SOURCE_USER);\n    await startUserCapture(dispatch, settings, userConstraints);\n    await queryMediaDevices(dispatch);\n  };\n\n  const clickDisplay = async() => {\n    setActiveSource(VIDEO_SOURCE_DISPLAY);\n    await startDisplayCapture(dispatch, settings, displayConstraints);\n  };\n\n  const clickBoth = async() => {\n    setActiveSource(VIDEO_SOURCE_BOTH);\n    await startUserCapture(dispatch, settings, userConstraints);\n    await Promise.all([\n      queryMediaDevices(dispatch),\n      startDisplayCapture(dispatch, settings, displayConstraints),\n    ]);\n  };\n\n\n  if (!displaySupported && !userSupported) {\n    return <Notification isDanger>{t('sources-video-none-available')}</Notification>;\n  }\n\n  return <React.Fragment>\n    <GlobalHotKeys keyMap={recordShortcuts} handlers={handlers}>\n      <Spacer />\n      <Flex\n        sx={{\n          flexDirection: ['column', 'row'],\n          maxWidth: [270, 850],\n          width: '100%',\n          mx: ['auto', 'none'],\n          mb: 3,\n          flex: '4 1 auto',\n          maxHeight: ['none', '270px'],\n          justifyContent: 'center',\n          '& > :not(:last-of-type)': {\n            mb: [3, 0],\n            mr: [0, 3],\n          },\n        }}\n      >\n        { (displaySupported || !onMobileDevice()) && <OptionButton\n          label={t('sources-scenario-display')}\n          icon={faChalkboard}\n          onClick={clickDisplay}\n          disabledText={displaySupported ? false : t('sources-video-display-not-supported')}\n        /> }\n        { (displaySupported || !onMobileDevice()) && userSupported && <OptionButton\n          label={t('sources-scenario-display-and-user')}\n          icon={faChalkboardTeacher}\n          onClick={clickBoth}\n          disabledText={\n            displaySupported\n              ? (userHasWebcam ? false : t('sources-video-no-cam-detected'))\n              : t('sources-video-display-not-supported')\n          }\n        /> }\n        { userSupported && <OptionButton\n          label={t('sources-scenario-user')}\n          icon={faUser}\n          onClick={clickUser}\n          disabledText={userHasWebcam ? false : t('sources-video-no-cam-detected')}\n        /> }\n      </Flex>\n      <Spacer />\n    </GlobalHotKeys>\n  </React.Fragment>;\n};\n\nconst OptionButton = ({ icon, label, onClick, disabledText = false }) => {\n  const disabled = disabledText !== false;\n\n  return (\n    <button\n      onClick={onClick}\n      disabled={disabled}\n      sx={{\n        fontFamily: 'inherit',\n        color: disabled ? 'gray.2' : 'gray.0',\n        border: theme => `2px solid ${disabled ? theme.colors.gray[2] : 'black'}`,\n        backgroundColor: 'gray.4',\n        borderRadius: '8px',\n        flex: ['1 1 auto', '0 1 100%'],\n        minWidth: '180px',\n        maxWidth: '300px',\n        minHeight: '120px',\n        maxHeight: '250px',\n        p: 2,\n        '&:hover': disabled ? {} : {\n          boxShadow: theme => `0 0 10px ${theme.colors.gray[2]}`,\n          filter: 'brightness(1.2)',\n        },\n      }}\n    >\n      <div sx={{ display: 'block', textAlign: 'center', mb: 3 }}>\n        <FontAwesomeIcon icon={icon} size=\"3x\"/>\n      </div>\n      <div sx={{ fontSize: 4 }}>{label}</div>\n      <div sx={{ fontSize: 2, mt: 1 }}>{disabledText}</div>\n    </button>\n  );\n};\n\nconst Spacer = rest => <div sx={{ flex: '1 0 0' }} {...rest}></div>;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faExclamationTriangle, faPause } from '@fortawesome/free-solid-svg-icons';\nimport { useEffect, useRef } from 'react';\n\nimport { STATE_PAUSED } from './index.js';\nimport { useStudioState } from '../../../studio-state';\nimport { VideoBox, useVideoBoxResize } from '../elements.js';\nimport { dimensionsOf } from '../../../util.js';\n\nexport default function MediaDevices({ recordingState }) {\n  const { t } = useTranslation();\n  const { displayStream, userStream, displayUnexpectedEnd, userUnexpectedEnd } = useStudioState();\n\n  const paused = recordingState === STATE_PAUSED;\n\n  let children = [];\n  if (displayStream || displayUnexpectedEnd) {\n    children.push({\n      body: <MediaDevice title={t('share-desktop')} stream={displayStream} paused={paused} />,\n      dimensions: () => dimensionsOf(displayStream),\n    });\n  }\n  if (userStream || userUnexpectedEnd) {\n    children.push({\n      body: <MediaDevice title={t('share-camera')} stream={userStream} paused={paused} />,\n      dimensions: () => dimensionsOf(userStream),\n    });\n  }\n\n  return <VideoBox gap={20}>{ children }</VideoBox>;\n}\n\nfunction MediaDevice({ title, stream, paused }) {\n  const resizeVideoBox = useVideoBoxResize();\n  const videoRef = useRef();\n\n  useEffect(() => {\n    const v = videoRef.current;\n    if (v && stream) {\n      if (!v.srcObject) {\n        v.srcObject = stream;\n      }\n      v.addEventListener('resize', resizeVideoBox);\n\n      if (paused) {\n        v.pause();\n      } else {\n        v.play();\n      }\n\n      return () => v.removeEventListener('resize', resizeVideoBox);\n    }\n  });\n\n  if (!stream) {\n    return (\n      <div sx={{\n        width: '100%',\n        height: '100%',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n      }}>\n        <FontAwesomeIcon icon={faExclamationTriangle} size=\"3x\" />\n      </div>\n    );\n  }\n\n  return (\n    <div\n      sx={{\n        position: 'relative',\n        backgroundColor: 'gray.3',\n        boxShadow: '0 2px 2px rgba(0, 0, 0, 0.35)',\n        overflow: 'hidden',\n        height: '100%',\n        cursor: stream ? 'initial' : 'pointer',\n      }}\n    >\n      {paused && (\n        <div\n          sx={{\n            position: 'absolute',\n            width: '100%',\n            height: '100%',\n            backgroundColor: 'rgba(255, 255, 255, 0.5)',\n          }}\n        >\n          <FontAwesomeIcon\n            icon={faPause}\n            sx={{\n              color: '#000',\n              fontSize: '140px',\n              maxWidth: '40%',\n              maxHeight: '40%',\n              position: 'absolute',\n              top: 0,\n              left: 0,\n              bottom: 0,\n              right: 0,\n              margin: 'auto',\n              animation: '3s ease-in-out infinite none pulse',\n            }}\n          />\n        </div>\n      )}\n\n      <video\n        ref={videoRef}\n        autoPlay\n        muted\n        tabIndex={'-1'}\n        sx={{\n          outline: 'none',\n          width: '100%',\n          height: '100%',\n          background: 'transparent'\n        }}\n      ></video>\n    </div>\n  );\n}\n","import { dimensionsOf } from './util.js';\n\nexport default class Recorder {\n\n  #recorder\n  #data\n  #dimensions\n\n  onStop\n\n  constructor(stream, settings, options = {}) {\n    // Figure out MIME type.\n    let mimeType;\n    if ('isTypeSupported' in MediaRecorder) {\n      mimeType = (settings?.mimes || [])\n        .find(mime => MediaRecorder.isTypeSupported(mime));\n      if (mimeType) {\n        console.debug(\"using first supported MIME type from settings: \", mimeType);\n      } else if (settings?.mimes) {\n        console.debug(\"None of the MIME types specified in settings are supported by \"\n          + \"this `MediaRecorder`\");\n      }\n    } else if (settings?.mimes) {\n      console.debug(\"MIME types were specified, but `MediaRecorder.isTypeSupported` is not \"\n        + \"supported by your browser\");\n    }\n\n\n    this.#reset();\n\n    this.#dimensions = dimensionsOf(stream);\n    const videoBitsPerSecond = settings?.videoBitrate;\n    this.onStop = options.onStop;\n\n    this.#recorder = new MediaRecorder(stream, { mimeType, videoBitsPerSecond });\n    this.#recorder.ondataavailable = this.#onDataAvailable;\n    this.#recorder.onstop = this.#onStop;\n  }\n\n  #reset = () => {\n    this.#data = [];\n  }\n\n  #onDataAvailable = event => {\n    if (event.data.size > 0) {\n      this.#data.push(event.data);\n    } else {\n      console.log(\"Recording data has size 0!\", event);\n    }\n  }\n\n  #onStop = event => {\n    const mimeType = this.#data[0]?.type || this.#recorder.mimeType;\n    const media = new Blob(this.#data, { type: mimeType });\n    const url = URL.createObjectURL(media);\n\n    this.#reset();\n\n    this.onStop?.({ url, media, mimeType, dimensions: this.#dimensions });\n  }\n\n  start() {\n    this.#recorder.start();\n  }\n\n  pause() {\n    this.#recorder.pause();\n  }\n\n  resume() {\n    this.#recorder.resume();\n  }\n\n  stop() {\n    this.#recorder.stop();\n  }\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faCircle,\n  faCircleNotch,\n  faPauseCircle,\n  faPlayCircle,\n  faStopCircle\n} from '@fortawesome/free-solid-svg-icons';\n\nconst Button = ({ large, ...rest }) => (\n  <button\n    sx={{\n      display: 'grid',\n      backgroundColor: 'transparent',\n      border: 'none',\n      position: 'relative',\n      overflow: 'hidden',\n      my: 0,\n      mx: large ? '15px' : 0,\n      padding: 0,\n      fontSize: large ? '5rem' : '3.5rem',\n      lineHeight: large ? '5rem' : '3.5rem',\n      svg: {\n        margin: 0,\n        padding: 0,\n        outline: 'none'\n      }\n    }}\n    {...rest}\n  />\n);\n\nexport const PauseButton = props => (\n  <Button onClick={props.onClick} title={props.title}\n    sx={{\n      '&:focus-visible': {\n        outline: theme => `7px solid ${theme.colors.focus[3]} !important`,\n        outlineOffset: '-1px',\n        borderRadius: '50%',\n      },\n    }}\n  >\n    <span className=\"fa-layers\">\n      <FontAwesomeIcon icon={faPauseCircle} sx={{ color: 'button_bg' }} />\n    </span>\n  </Button>\n);\n\nexport const RecordButton = props => (\n  <Button\n    onClick={props.onClick}\n    title={props.title}\n    large={props.large ? 1 : 0}\n    disabled={props.disabled || props.countdown}\n    sx={{\n      color: '#bd181c !important',\n      'svg + svg': { color: '#e22319' },\n      ':disabled': { color: '#aaa' },\n      ':disabled svg + svg': { color: '#bbb' },\n      '&:focus-visible': {\n        outline: theme => `7px solid ${theme.colors.focus[0]} !important`,\n        outlineOffset: '-1px',\n        borderRadius: '50%',\n      },\n    }}\n  >\n    <span className=\"fa-layers record-buttons\">\n      <FontAwesomeIcon icon={props.countdown ? faCircleNotch : faCircle} spin={props.countdown} />\n      <FontAwesomeIcon icon={faCircle} transform=\"shrink-6\" />\n    </span>\n  </Button>\n);\n\nexport const ResumeButton = props => (\n  <Button onClick={props.onClick} title={props.title}\n    sx={{\n      '&:focus-visible': {\n        outline: theme => `7px solid ${theme.colors.focus[3]} !important`,\n        outlineOffset: '-1px',\n        borderRadius: '50%',\n      },\n    }}\n  >\n    <span className=\"fa-layers\">\n      <FontAwesomeIcon icon={faPlayCircle} sx={{ color: 'button_bg' }} />\n    </span>\n  </Button>\n);\n\nexport const StopButton = props => (\n  <Button\n    onClick={props.onClick}\n    title={props.title}\n    large={!!props.large}\n    sx={{\n      color: '#bd181c',\n      '&:focus-visible': {\n        outline: theme => `7px solid ${theme.colors.focus[0]} !important`,\n        outlineOffset: '-1px',\n        borderRadius: '50%',\n      },\n    }}\n  >\n    <FontAwesomeIcon icon={faStopCircle}\n      sx={{ color: '#bd181c !important' }}\n    />\n  </Button>\n);\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { Component } from 'react';\n\nclass Clock extends Component {\n  #last = null;\n  #timerID = null;\n  #isMounted = false;\n\n  constructor(props) {\n    super(props);\n    this.state = { milliseconds: 0 };\n    this.#last = new Date();\n    this.#timerID = setInterval(() => this.tick(), 100);\n  }\n\n  componentDidMount() {\n    this.#isMounted = true;\n  }\n\n  componentWillUnmount() {\n    this.stopTimer();\n    this.#isMounted = false;\n  }\n\n  resumeTimer() {\n    if (!this.timerId) {\n      this.#timerID = setInterval(() => this.tick(), 100);\n      this.#last = new Date();\n    }\n  }\n\n  stopTimer() {\n    clearInterval(this.#timerID);\n    this.#timerID = null;\n  }\n\n  componentDidUpdate(prevProps) {\n    // recording state did not change\n    if (this.props.isPaused === prevProps.isPaused) {\n      return;\n    }\n\n    if (this.props.isPaused) {\n      this.stopTimer();\n    } else {\n      this.resumeTimer();\n    }\n  }\n\n  tick() {\n    if (this.#isMounted) {\n      const now = new Date();\n      const passed = now - this.#last;\n      this.#last = now;\n      this.setState(state => ({\n        milliseconds: state.milliseconds + passed,\n      }));\n    }\n  }\n\n  render() {\n    const duration = this.state.milliseconds;\n    let timeArr = [\n      (duration / 3600000) >> 0,\n      ((duration / 60000) >> 0) % 60,\n      ((duration / 1000) >> 0) % 60\n    ];\n    if (timeArr[0] === 0) {\n      timeArr = timeArr.slice(1);\n    }\n    const content = timeArr.map(unit => (unit < 10 ? '0' : '') + unit).join(':');\n\n    return <span sx={{ fontSize: 3 }}>{content}</span>;\n  }\n}\n\nexport default Clock;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { useEffect, useRef } from 'react';\nimport { Beforeunload } from 'react-beforeunload';\nimport { useTranslation } from 'react-i18next';\nimport { useHistory } from \"react-router\";\n\nimport Recorder from '../../../recorder';\nimport { useSettings } from '../../../settings';\nimport { useDispatch, useStudioState } from '../../../studio-state';\n\nimport { PauseButton, RecordButton, ResumeButton, StopButton } from './recording-buttons';\nimport Clock from './clock';\nimport { STATE_INACTIVE, STATE_PAUSED, STATE_RECORDING } from './index.js';\n\nimport Tooltip from '../../../Tooltip';\nimport { GlobalHotKeys } from 'react-hotkeys';\nimport { recordShortcuts } from '../keyboard-shortcuts/globalKeys';\n\nfunction addRecordOnStop(dispatch, deviceType) {\n  return ({ media, url, mimeType, dimensions }) => {\n    dispatch({ type: 'ADD_RECORDING', payload: { deviceType, media, url, mimeType, dimensions }});\n  };\n}\n\nfunction mixAudioIntoVideo(audioStream, videoStream) {\n  if (!(audioStream?.getAudioTracks().length)) {\n    return videoStream;\n  }\n  return new MediaStream([...videoStream.getVideoTracks(), ...audioStream.getAudioTracks()]);\n}\n\nlet unblockers = [];\n\nexport default function RecordingControls({\n  handleRecorded,\n  recordingState,\n  setRecordingState,\n}) {\n  const { t } = useTranslation();\n  const dispatch = useDispatch();\n  const settings = useSettings();\n\n  const {\n    audioStream,\n    displayStream,\n    userStream,\n    userUnexpectedEnd,\n    displayUnexpectedEnd,\n    audioUnexpectedEnd,\n  } = useStudioState();\n\n\n  const desktopRecorder = useRef(null);\n  const videoRecorder = useRef(null);\n\n  const canRecord = (displayStream || userStream)\n    && !userUnexpectedEnd && !displayUnexpectedEnd && !audioUnexpectedEnd;\n\n  const history = useHistory();\n\n  const record = () => {\n    // In theory, we should never have recordings at this point. But just to be\n    // sure, in case of a bug elsewhere, we clear the recordings here.\n    dispatch({ type: 'CLEAR_RECORDINGS' });\n\n    if (displayStream) {\n      const onStop = addRecordOnStop(dispatch, 'desktop');\n      const stream = mixAudioIntoVideo(audioStream, displayStream);\n      desktopRecorder.current = new Recorder(stream, settings.recording, { onStop });\n      desktopRecorder.current.start();\n    }\n\n    if (userStream) {\n      const onStop = addRecordOnStop(dispatch, 'video');\n      const stream = mixAudioIntoVideo(audioStream, userStream);\n      videoRecorder.current = new Recorder(stream, settings.recording, { onStop });\n      videoRecorder.current.start();\n    }\n\n    dispatch({ type: 'START_RECORDING' });\n    unblockers.push(history.block(t('confirm-cancel-recording')));\n  };\n\n  const resume = () => {\n    desktopRecorder.current?.resume();\n    videoRecorder.current?.resume();\n  };\n\n  const pause = () => {\n    desktopRecorder.current?.pause();\n    videoRecorder.current?.pause();\n  };\n\n  const stop = (premature = false) => {\n    desktopRecorder.current?.stop();\n    videoRecorder.current?.stop();\n    handleRecorded();\n    dispatch({ type: premature ? 'STOP_RECORDING_PREMATURELY' : 'STOP_RECORDING' });\n    unblockers.forEach(b => b());\n    unblockers = [];\n  };\n\n  useEffect(() => {\n    // Detect if a stream ended unexpectedly. In that case we want to stop the\n    // recording completely.\n    const unexpectedEnd = userUnexpectedEnd || displayUnexpectedEnd || audioUnexpectedEnd;\n    if (unexpectedEnd && (recordingState === STATE_RECORDING || recordingState === STATE_PAUSED)) {\n      stop(true);\n    }\n\n    history.listen(() => {\n      // This only happens when the user uses \"back\" or \"forward\" in their\n      // browser and they confirm they want to discard the recording.\n      if (recordingState !== 'STATE_INACTIVE') {\n        dispatch({ type: 'STOP_RECORDING' });\n      }\n\n      unblockers.forEach(b => b());\n      unblockers = [];\n    });\n  });\n\n\n  const handlePause = () => {\n    setRecordingState(STATE_PAUSED);\n    pause();\n  };\n\n  const handleResume = () => {\n    setRecordingState(STATE_RECORDING);\n    resume();\n  };\n\n  const handleRecord = () => {\n    if (!canRecord) {\n      return;\n    }\n    setRecordingState(STATE_RECORDING);\n    record();\n  };\n\n  const handleStop = () => {\n    setRecordingState(STATE_INACTIVE);\n    stop();\n  };\n\n  const switchPlayPause = keyEvent => {\n    if (recordingState === STATE_RECORDING) {\n      handlePause(keyEvent);\n    } else if (recordingState === STATE_PAUSED) {\n      handleResume(keyEvent);\n    }\n  };\n\n  const handlers = {\n    START_RECORDING: keyEvent => { if(keyEvent) { handleRecord(keyEvent); } },\n    STOP_RECORDING: keyEvent => { if(keyEvent) { handleStop(keyEvent); } },\n    PAUSE_RECORDING: keyEvent => { if(keyEvent) { switchPlayPause(keyEvent); } },\n  };\n\n  return (\n    <GlobalHotKeys keyMap={recordShortcuts} handlers={handlers}>\n      <div sx={{ m: 0, width: recordingState !== STATE_INACTIVE ? '280px' : 'auto' }}>\n        { recordingState !== STATE_INACTIVE && (\n          <Beforeunload onBeforeunload={event => event.preventDefault()} />\n        )}\n\n        <div className=\"buttons\" sx={{ display: 'flex', alignItems: 'center' }}>\n          { recordingState !== STATE_INACTIVE && <div sx={{ flex: 1, textAlign: 'right' }}>\n            { recordingState === STATE_RECORDING && (\n              <Tooltip content={t('pause-button-title')} offset={[0, 50]}>\n                <PauseButton\n                  recordingState={recordingState}\n                  onClick={handlePause}\n                />\n              </Tooltip>\n            )}\n\n            { recordingState === STATE_PAUSED && (\n              <Tooltip content={t('resume-button-title')} offset={[0, 50]}>\n                <ResumeButton\n                  recordingState={recordingState}\n                  onClick={handleResume}\n                />\n              </Tooltip>\n            )}\n          </div> }\n\n          <div className=\"center\">\n            { recordingState === STATE_INACTIVE ? (\n              <Tooltip content={t('record-button-title')} offset={[0, 50]}>\n                <RecordButton\n                  large\n                  recordingState={recordingState}\n                  onClick={handleRecord}\n                  disabled={!canRecord}\n                />\n              </Tooltip>\n            ) : (\n              <Tooltip content={t('stop-button-title')} offset={[0, 50]}>\n                <StopButton\n                  large\n                  recordingState={recordingState}\n                  onClick={handleStop}\n                />\n              </Tooltip>\n            )}\n          </div>\n\n          { recordingState !== STATE_INACTIVE && <div sx={{ flex: 1 }}>\n            <Clock isPaused={recordingState === STATE_PAUSED} />\n          </div> }\n        </div>\n      </div>\n    </GlobalHotKeys>\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { Flex, Text } from '@theme-ui/components';\nimport { useCallback, useState } from 'react';\n\nimport { useStudioState, useDispatch } from '../../../studio-state';\nimport { useOpencast } from '../../../opencast';\n\nimport { ActionButtons } from '../elements';\n\nimport MediaDevices from './media-devices';\nimport RecordingControls from './recording-controls';\nimport { stopCapture } from '../capturer';\nimport Notification from '../../notification';\n\n\nexport const STATE_INACTIVE = 'inactive';\nexport const STATE_PAUSED = 'paused';\nexport const STATE_RECORDING = 'recording';\n\n\nexport default function Recording(props) {\n  const { t } = useTranslation();\n  const state = useStudioState();\n  const recordingDispatch = useDispatch();\n  const opencast = useOpencast();\n\n  const [recordingState, setRecordingState] = useState(STATE_INACTIVE);\n\n  const handleRecorded = () => {\n    opencast.refreshConnection();\n    stopCapture(state, recordingDispatch);\n    props.nextStep();\n  };\n\n  const backToAudio = useCallback(() => {\n    props.previousStep();\n  }, [props]);\n\n  return (\n    <Flex sx={{\n      flexDirection: 'column',\n      height: '100%',\n      position: 'relative',\n      flexGrow: 1,\n    }}>\n      { (state.displayUnexpectedEnd || state.userUnexpectedEnd) && (\n        <Notification isDanger>\n          <Text>{t('error-lost-video-stream')}</Text>\n        </Notification>\n      )}\n      { state.audioUnexpectedEnd && (\n        <Notification isDanger>\n          <Text>{t('error-lost-audio-stream')}</Text>\n        </Notification>\n      )}\n\n      <MediaDevices recordingState={recordingState} />\n\n      <div sx={{ m: 3 }}>\n        <ActionButtons prev={recordingState === STATE_INACTIVE && { onClick: backToAudio }}>\n          <RecordingControls\n            handleRecorded={handleRecorded}\n            recordingState={recordingState}\n            setRecordingState={setRecordingState}\n          />\n        </ActionButtons>\n      </div>\n    </Flex>\n  );\n}\n","var _path;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgCutOutIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    \"aria-hidden\": \"true\",\n    focusable: \"false\",\n    role: \"img\",\n    viewBox: \"0 0 100 65\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"m24.6 0c-0.447 0-0.894 0.171-1.24 0.511l-3.07 3.05c-0.685 0.681-0.685 1.78 0 2.46l58.8 58.5c0.685 0.681 1.79 0.681 2.47 0l3.07-3.05c0.685-0.681 0.685-1.78 0-2.46l-6.68-6.64h22v-7.32h-15.6c-1.44 0-2.6-1.15-2.6-2.59v-14.3c0-1.43 1.16-2.59 2.6-2.59h15.6v-7.32h-56.4l-17.8-17.7c-0.343-0.341-0.79-0.511-1.24-0.511zm-24.6 18.2v7.32h3.7c1.44 0 2.6 1.15 2.6 2.59v14.3c0 1.43-1.16 2.59-2.6 2.59h-3.7v7.32h55.8l-15.4-15.3v5.36c0 1.43-1.16 2.59-2.6 2.59h-21.8c-1.44 0-2.6-1.15-2.6-2.59v-14.3c0-1.43 1.16-2.59 2.6-2.59h12.8l-7.36-7.32zm51 7.32h21c1.44 0 2.6 1.15 2.6 2.59v14.3c0 1.43-1.16 2.59-2.6 2.59h-1.4z\",\n    fill: \"currentColor\"\n  })));\n}\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgCutOutIcon);\nexport default __webpack_public_path__ + \"static/media/cut-out-icon.069c1997.svg\";\nexport { ForwardRef as ReactComponent };","var _g;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgCutHereIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    \"aria-hidden\": \"true\",\n    focusable: \"false\",\n    role: \"img\",\n    viewBox: \"0 0 100 90\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    fill: \"currentColor\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"m49.7 0.00188c-2.91 0.0589-5.75 1.49-7.44 4.08-1.06 1.62-1.51 3.48-1.42 5.29-0.0794 0.122-0.986 1.51-1.13 1.72-0.13-0.2-0.997-1.54-1.08-1.66 0.0951-1.81-0.348-3.67-1.4-5.29-1.68-2.59-4.51-4.04-7.42-4.11-1.75-0.0426-3.52 0.41-5.09 1.41-4.18 2.66-5.4 8.27-2.72 12.4 2.56 3.96 7.83 5.24 11.9 3.02l0.992 1.53c-2.84 4.35-4.9 7.5-6.74 10.3-3.09 4.73-1.94 8.93 2.01 11.5l9.47-14.5 9.45 14.6c3.96-2.55 5.13-6.75 2.06-11.5-1.84-2.84-3.9-6.03-6.74-10.4l1.04-1.59c4.1 2.23 9.37 0.974 12-2.97 2.03-3.1 1.85-7.03-0.114-9.93-0.656-0.968-1.51-1.82-2.55-2.49-1.56-1.01-3.33-1.47-5.08-1.43zm0.0903 5.96c0.578-0.0076 1.17 0.154 1.7 0.499 0.357 0.23 0.649 0.514 0.872 0.835 0.668 0.962 0.712 2.24 0.0174 3.31-0.926 1.42-2.74 1.8-4.17 0.882-1.43-0.919-1.82-2.73-0.889-4.14 0.579-0.886 1.51-1.37 2.47-1.38zm-20.1 0.0236c0.963 0.0168 1.89 0.504 2.46 1.39 0.92 1.42 0.525 3.22-0.906 4.14s-3.25 0.521-4.17-0.9c-0.92-1.42-0.525-3.22 0.906-4.14 0.537-0.343 1.13-0.502 1.71-0.492zm10 24.1a1.83 1.81 0 0 0-1.83 1.81v3.62a1.83 1.81 0 0 0 1.83 1.81 1.83 1.81 0 0 0 1.83-1.81v-3.62a1.83 1.81 0 0 0-1.83-1.81zm0 10.9a1.83 1.81 0 0 0-1.83 1.81v3.62a1.83 1.81 0 0 0 1.83 1.81 1.83 1.81 0 0 0 1.83-1.81v-3.62a1.83 1.81 0 0 0-1.83-1.81zm-1.5 8.8a2.43 2.42 0 0 0-2.43 2.42v35.4a2.43 2.42 0 0 0 2.43 2.42h8.94v-4.83h-6.51v-30.6h6.1v-4.83zm6.51 8.86v22.5h55.2v-4.83h-3.22c-0.954 0-1.72-0.761-1.72-1.71v-9.47c0-0.946 0.767-1.71 1.72-1.71h3.22v-4.83zm6.59 4.83h14.4c0.954 0 1.72 0.762 1.72 1.71v9.47c0 0.946-0.767 1.71-1.72 1.71h-14.4c-0.954 0-1.72-0.761-1.72-1.71v-9.47c0-0.946 0.767-1.71 1.72-1.71zm22.7 0h14.4c0.954 0 1.72 0.762 1.72 1.71v9.47c0 0.946-0.767 1.71-1.72 1.71h-14.4c-0.954 0-1.72-0.761-1.72-1.71v-9.47c0-0.946 0.769-1.71 1.72-1.71z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"m0 58.6v4.83h2.44c0.954 0 1.72 0.762 1.72 1.71v9.47c0 0.946-0.768 1.71-1.72 1.71h-2.44v4.83h31.8v-22.5zm10.8 4.83h14.4c0.954 0 1.72 0.762 1.72 1.71v9.47c0 0.946-0.768 1.71-1.72 1.71h-14.4c-0.954 0-1.72-0.762-1.72-1.71v-9.47c0-0.946 0.768-1.71 1.72-1.71z\",\n    opacity: 0.2\n  }))));\n}\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgCutHereIcon);\nexport default __webpack_public_path__ + \"static/media/cut-here-icon.0a56383d.svg\";\nexport { ForwardRef as ReactComponent };","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Themed, useColorMode } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTrash, faPlay, faPause } from '@fortawesome/free-solid-svg-icons';\n\nimport { Fragment, forwardRef, useState, useRef, useEffect, useImperativeHandle } from 'react';\nimport { Link, IconButton, Flex, Spinner, Text } from '@theme-ui/components';\nimport { Trans, useTranslation } from 'react-i18next';\n\nimport { ActionButtons, StepContainer, VideoBox } from '../elements';\nimport { useStudioState, useDispatch } from '../../../studio-state';\nimport { useSettings } from '../../../settings';\nimport Notification from '../../notification';\nimport { ReactComponent as CutOutIcon } from './cut-out-icon.svg';\nimport { ReactComponent as CutHereIcon } from './cut-here-icon.svg';\nimport Tooltip from '../../../Tooltip';\n\nimport { GlobalHotKeys } from 'react-hotkeys';\nimport { editShortcuts } from '../keyboard-shortcuts/globalKeys';\n\n// In some situation we would like to set the current time to 0 or check for it.\n// Thanks to a browser bug, setting the current time to 0 fails. Using a number\n// slightly higher works thought. So we use this 1ms time for now. Sigh.\nconst ALMOST_ZERO = 0.001;\n\nexport default function Review(props) {\n  const { t } = useTranslation();\n  const recordingDispatch = useDispatch();\n  const { recordings, prematureRecordingEnd, videoChoice } = useStudioState();\n  const emptyRecording = recordings.some(rec => rec.media.size === 0);\n  const previewController = useRef();\n  const [currentTime, setCurrentTime] = useState(0);\n  const [previewReady, setPreviewReady] = useState();\n\n  const handleBack = () => {\n    const doIt = window.confirm(t('confirm-discard-recordings'));\n    if (doIt) {\n      recordingDispatch({ type: 'RESET' });\n      props.firstStep();\n    }\n  };\n\n  const handleNext = () => {\n    props.nextStep();\n  };\n\n  const expectedRecordings = (() => {\n    switch (videoChoice) {\n      case 'none':\n        return 0;\n      case 'both':\n        return 2;\n      default:\n        return 1;\n    }\n  })();\n\n  return (\n    <StepContainer>\n      <Themed.h1>{ t('review-heading') }</Themed.h1>\n\n      {prematureRecordingEnd && (\n        <Notification isDanger>\n          <Text>{t('error-lost-stream-end-recording')}</Text>\n        </Notification>\n      )}\n\n      {emptyRecording && (\n        <Notification isDanger>{t('review-error-empty-recording')}</Notification>\n      )}\n\n      {(\n        !previewReady || recordings.length !== expectedRecordings\n      ) && <div sx={{\n        flex: 1,\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n      }}>\n        <Spinner title={t('save-creation-waiting-for-recordings')} />\n      </div>\n      }\n      {recordings.length === expectedRecordings && <div sx={previewReady ? {\n        display: 'flex',\n        flex: '1 1 auto',\n        flexDirection: 'column'\n      } : {\n        display: 'none'\n      }}>\n        <Preview\n          ref={previewController}\n          onTimeUpdate={event => {\n            setCurrentTime(event.target.currentTime);\n          }}\n          onReady={() => setPreviewReady(true)}\n        />\n\n        <div sx={{ mb: 3 }} />\n\n        <ControlBox {...{ previewController, currentTime }} />\n      </div>}\n\n      <div sx={{ mb: 3 }} />\n\n      <ActionButtons\n        prev={{\n          onClick: handleBack,\n          danger: true,\n          label: 'review-button-discard-and-record',\n        }}\n        next={{ onClick: handleNext }}\n      />\n    </StepContainer>\n  );\n};\n\nconst ControlBox = ({ previewController, currentTime }) => (\n  <div sx={{\n    backgroundColor: 'gray.4',\n    color: 'text',\n    borderRadius: '8px',\n  }}>\n    <VideoControls {...{ previewController, currentTime }} />\n    <Scrubber {...{ previewController, currentTime }} />\n  </div>\n);\n\nconst Scrubber = ({ previewController, currentTime }) => {\n  const duration = previewController.current?.duration || Infinity;\n  const { start, end } = useStudioState();\n\n  const [colorMode] = useColorMode();\n\n  const setTime = mouseEvent => {\n    const rect = mouseEvent.target.getBoundingClientRect();\n    const x = mouseEvent.clientX - rect.x;\n    let progress = x / rect.width;\n    if (progress < 0) {\n      progress = 0;\n    } else if (progress > 1) {\n      progress = 1;\n    }\n\n    if (previewController.current) {\n      previewController.current.currentTime = progress * duration;\n    }\n  };\n\n  const cutStyle = {\n    position: 'absolute',\n    backgroundColor: colorMode === 'dark' ? 'gray.2' : 'gray.3',\n    height: '100%',\n    boxSizing: 'content-box',\n  };\n\n  return (\n    <div sx={{ p: 2 }}>\n      <div sx={{ py: 1, position: 'relative' }}>\n        <div\n          onClick={e => setTime(e)}\n          onMouseMove={e => {\n            // Ignore unless only the primary button is pressed (`buttons` is a\n            // bitset).\n            if (e.buttons === 1) {\n              // TODO: maybe debounce this? Browsers seem to somewhat debounce\n              // that already.\n              setTime(e);\n            }\n          }}\n          sx={{\n            position: 'absolute',\n            width: '100%',\n            height: '100%',\n            cursor: 'pointer',\n            top: 0,\n            zIndex: 10,\n          }}\n        />\n        <div sx={{\n          position: 'relative',\n          backgroundColor: '#6bc295',\n          height: '12px',\n          width: '100%',\n          borderRadius: '6px',\n          overflow: 'hidden',\n          '@media not (any-pointer: fine)': {\n            height: '20px',\n            borderRadius: '10px',\n          }\n        }}>\n          { (start != null && start > 0) && <div sx={{\n            left: 0,\n            borderRight: '2px solid black',\n            width: `${(start / duration) * 100}%`,\n            ...cutStyle,\n          }} /> }\n          { (end != null && end < duration) && <div sx={{\n            right: 0,\n            borderLeft: '2px solid black',\n            width: `${((duration - end) / duration) * 100}%`,\n            ...cutStyle,\n          }} /> }\n          <div sx={{\n            position: 'absolute',\n            left: 0,\n            width: `${(currentTime / duration) * 100}%`,\n            backgroundColor: 'black',\n            height: '100%',\n            opacity: 0.3,\n          }} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst VideoControls = ({ currentTime, previewController }) => {\n  const { start, end } = useStudioState();\n  const recordingDispatch = useDispatch();\n  const settings = useSettings();\n  const { t } = useTranslation();\n\n  const duration = previewController.current?.duration;\n\n  const switchPlayPause = keyEvent => {\n    const controller = previewController.current;\n    if (controller.isPlaying) {\n      controller.pause(keyEvent);\n    } else if (controller.isReadyToPlay) {\n      controller.play(keyEvent);\n    }\n  };\n\n  const leftMarker = useRef(null);\n  const rightMarker = useRef(null);\n\n  const handlers = {\n    PLAY_PAUSE: keyEvent => { if(keyEvent) { switchPlayPause(keyEvent); } },\n    DELETE_CROP_MARK_LEFT: keyEvent => { if(keyEvent) { leftMarker.current?.click(); } },\n    DELETE_CROP_MARK_RIGHT: keyEvent => { if(keyEvent) { rightMarker.current?.click(); } },\n  };\n\n  return <div sx={{ textAlign: 'center' }}>\n    <GlobalHotKeys keyMap={editShortcuts} handlers={handlers}>\n      <Flex\n        sx={{\n          backgroundColor: 'gray.4',\n          p: 2,\n          justifyContent: 'center',\n          alignItems: 'flex-end',\n          '& > *': {\n            mx: 2,\n          }\n        }}\n      >\n        { settings.review?.disableCutting || <CutControls\n          marker=\"start\"\n          innerRef={leftMarker}\n          value={start}\n          control={end}\n          invariant={(start, end) => start < end}\n          { ...{ recordingDispatch, previewController, currentTime } }\n        /> }\n        <Tooltip content={previewController.current?.isPlaying ? t('review-pause') : t('review-play')}>\n          <button\n            sx={{ backgroundColor: 'transparent', border: 'none', mx: 3, color: 'gray.0' }}\n            onClick={() => {\n              const controller = previewController.current;\n              if (controller) {\n                if (controller.isPlaying) {\n                  controller.pause();\n                } else if (controller.isReadyToPlay) {\n                  controller.play();\n                }\n              }\n            }}\n          >\n            <FontAwesomeIcon\n              icon={previewController.current?.isPlaying ? faPause : faPlay}\n              sx={{ fontSize: '50px', opacity: 0.8, '&:hover': { opacity: 1 }}}\n            />\n          </button>\n        </Tooltip>\n        { settings.review?.disableCutting || <CutControls\n          marker=\"end\"\n          innerRef={rightMarker}\n          value={end}\n          control={start}\n          invariant={(end, start) => start < end}\n          { ...{ recordingDispatch, previewController, currentTime } }\n        /> }\n      </Flex>\n      {t('review-player-progress', { currentTime, duration })}\n    </GlobalHotKeys>\n  </div>;\n};\n\nconst CutControls = (\n  { marker, value, control, invariant, currentTime, previewController, recordingDispatch, innerRef }\n) => {\n  const { t } = useTranslation();\n\n  const handlers = {\n    CUT_LEFT: keyEvent => { if(keyEvent) { document.getElementById(\"leftmarker\").click(); } },\n    CUT_RIGHT: keyEvent => { if(keyEvent) { document.getElementById(\"rightmarker\").click(); } },\n  };\n\n  const state = (\n    <GlobalHotKeys keyMap={editShortcuts} handlers={handlers}>\n      <div sx={{ flex: 1, textAlign: marker === 'start' ? 'right' : 'left', color: 'gray.0' }}>\n        { value !== null && <Fragment>\n          <Trans { ...{ t } } i18nKey={`review-${marker}`}>\n            {{ [marker]: value }} <Link href=\"\" onClick={event => {\n              event.preventDefault();\n              previewController.current.currentTime = value;\n            }} />\n          </Trans>\n          <Tooltip content={t(`review-remove-cut-point`)}>\n            <IconButton context={marker}\n              ref={innerRef} // for DELETE_CROP_MARK\n              onClick={\n                () => recordingDispatch({\n                  type: `UPDATE_${marker.toUpperCase()}`,\n                  payload: null,\n                })}\n            >\n              <FontAwesomeIcon icon={faTrash} />\n            </IconButton>\n          </Tooltip>\n        </Fragment> }\n      </div>\n    </GlobalHotKeys>\n  );\n\n  const disabled = (() => {\n    if (currentTime <= ALMOST_ZERO || currentTime >= previewController.current?.duration) {\n      return true;\n    }\n    if (control != null && !invariant(currentTime, control)) {\n      return true;\n    }\n    return false;\n  })();\n\n  const button = (\n    <GlobalHotKeys keyMap={editShortcuts} handlers={handlers}>\n      <Tooltip content={t(`review-set-${marker}`)}>\n        <button\n          id={marker === 'start' ? 'leftmarker' : 'rightmarker'}\n          {...{ disabled }}\n          onClick={() => {\n            let value = previewController.current.currentTime;\n            // We disable the buttons when the generated values would be invalid,\n            // but we rely on `timeupdate` events for that, which are not guaranteed\n            // to be timely, so we still have to check the invariant when actually\n            // updating the state. Here we decided to just clamp the value appropriately.\n            if (control != null && !invariant(value, control)) {\n              value = control;\n            }\n            recordingDispatch({\n              type: `UPDATE_${marker.toUpperCase()}`,\n              payload: value,\n            });\n          }}\n          sx={{\n            backgroundColor: 'transparent',\n            color: 'text',\n            border: 'none',\n            pt: '4px',\n            px: '8px',\n            borderRadius: '4px',\n            '&:disabled': {\n              opacity: 0.3,\n            },\n            '&:not(:disabled):hover': {\n              backgroundColor: 'gray.3'\n            },\n          }}\n        >\n          <CutHereIcon sx={{ height: '32px', transform: marker === 'end' ? 'scaleX(-1)' : '' }} />\n        </button>\n      </Tooltip>\n    </GlobalHotKeys>\n  );\n\n  return marker === 'start'\n    ? <Fragment>{ state }{ button }</Fragment>\n    : <Fragment>{ button }{ state }</Fragment>;\n};\n\nconst Preview = forwardRef(function _Preview({ onTimeUpdate, onReady }, ref) {\n  const { recordings, start, end } = useStudioState();\n  const { t } = useTranslation();\n\n  const videoRefs = [useRef(), useRef()];\n  const allVideos = videoRefs.slice(0, recordings.length);\n\n  const desktopIndex = recordings.length === 2\n    ? (recordings[0].deviceType === 'desktop' ? 0 : 1)\n    : null;\n\n  // The index of the last video ref that received an event (0 or 1).\n  const lastOrigin = useRef();\n\n  useImperativeHandle(ref, () => ({\n    get currentTime() {\n      return videoRefs[lastOrigin.current || 0].current.currentTime;\n    },\n    set currentTime(currentTime) {\n      allVideos.forEach(r => r.current.currentTime = currentTime);\n    },\n    get duration() {\n      return videoRefs[lastOrigin.current || 0].current?.duration;\n    },\n    get isPlaying() {\n      const v = videoRefs[lastOrigin.current || 0].current;\n      return v && v.currentTime > 0 && !v.paused && !v.ended;\n    },\n    get isReadyToPlay() {\n      // State 2 means \"at least enough data to play one frame\"\n      return allVideos.every(r => r.current.readyState >= 2);\n    },\n    play() {\n      allVideos.forEach(r => r.current.play());\n    },\n    pause() {\n      allVideos.forEach(r => r.current.pause());\n    },\n  }));\n\n  // Some browsers don't calculate the duration for the recorded videos\n  // preventing us from seeking in the video. We force it below\n  // in the event handlers of the video elements, but we want to hold off\n  // on some effects until that calculation is done.\n  const durationCalculationProgress = [useRef(), useRef()];\n  const [durationsCalculated, setDurationsCalculated] = useState();\n\n  // Some logic to decide whether we currently are in a part of the video that\n  // will be removed. The state will be updated in `onTimeUpdate` below and is\n  // only here to trigger a rerender: the condition for rendering the overlay is\n  // below.\n  const isInCutRegion = time => (start !== null && time < start) || (end !== null && time > end);\n  const currentTime = videoRefs[lastOrigin.current || 0].current?.currentTime || 0;\n  const overlayVisible = isInCutRegion(currentTime);\n  const [, setOverlayVisible] = useState(overlayVisible);\n\n  useEffect(() => {\n    if (durationsCalculated) {\n      onReady();\n    }\n  }, [onReady, durationsCalculated]);\n\n  // Setup backup synchronization between both video elements\n  useEffect(() => {\n    if (!durationsCalculated) {\n      return;\n    }\n\n    if (recordings.length === 2) {\n      // If we have two recordings, both will have audio. But the user doesn't\n      // want to hear audio twice, so we mute one video element. Particularly,\n      // we mute the desktop video, as there the audio/video synchronization is\n      // not as critical.\n      videoRefs[desktopIndex].current.volume = 0;\n\n      const va = videoRefs[0].current;\n      const vb = videoRefs[1].current;\n\n      // We regularly check if both video elements diverge too much from one\n      // another.\n      let frameCounter = 0;\n      let fixRequest;\n      const fixTime = () => {\n        // Only run every 60 frames.\n        if (frameCounter % 60 === 0) {\n          // We want the difference to be below 150ms. Usually, even without\n          // this backup solution, it should be below 50ms at all time. That's\n          // what testing showed.\n          const diff = Math.abs(va.currentTime - vb.currentTime);\n          if (diff > 0.15 && lastOrigin.current != null) {\n            const origin = videoRefs[lastOrigin.current].current;\n            const target = videoRefs[lastOrigin.current === 0 ? 1 : 0].current;\n            target.currentTime = origin.currentTime;\n          }\n        }\n\n        frameCounter++;\n        fixRequest = window.requestAnimationFrame(fixTime);\n      };\n      fixRequest = window.requestAnimationFrame(fixTime);\n\n      return () => window.cancelAnimationFrame(fixRequest);\n    }\n  });\n\n  const handlers = {\n    FORWARD_5_SEC: keyEvent => { if(keyEvent) { skipFiveSeconds(keyEvent); } },\n    BACKWARDS_5_SEC: keyEvent => { if(keyEvent) { skipFiveSeconds(keyEvent); } },\n    FORWARD_1_FRAME: keyEvent => { if(keyEvent) { skipFrame(keyEvent); } },\n    BACKWARDS_1_FRAME: keyEvent => { if(keyEvent) { skipFrame(keyEvent); } },\n  };\n\n  const skipFiveSeconds = keyEvent => {\n    videoRefs.forEach( video => {\n      if (video.current !== undefined) {\n        if (keyEvent.key === 'l' || keyEvent.key === 'ArrowRight') {\n          video.current.currentTime = Math.min(video.current.duration, video.current.currentTime + 5);\n        } else if (keyEvent.key === 'j' || keyEvent.key === 'ArrowLeft') {\n          video.current.currentTime = Math.max(0, video.current.currentTime - 5);\n        }\n      }\n    });\n  };\n\n  const skipFrame = keyEvent => {\n    const fps = 30;\n\n    videoRefs.forEach( video => {\n      if (video.current !== undefined) {\n        if (keyEvent.key === '.') {\n          video.current.currentTime = Math.min(video.current.duration, video.current.currentTime + (1 / fps));\n        } else if (keyEvent.key === ',') {\n          video.current.currentTime = Math.max(0, video.current.currentTime - (1 / fps));\n        }\n      }\n    });\n  };\n\n  const children = recordings.map((recording, index) => ({\n    body: (\n      <GlobalHotKeys keyMap={editShortcuts} handlers={handlers}>\n        <div sx={{ position: 'relative', width: '100%', height: '100%' }}>\n          { overlayVisible && <div\n            sx={{\n              position: 'absolute',\n              left: 0,\n              right: 0,\n              top: 0,\n              bottom: 0,\n              backgroundColor: 'rgba(0, 0, 0, 0.65)',\n              color: 'white',\n              display: 'flex',\n              flexDirection: 'column',\n              alignItems: 'center',\n              justifyContent: 'center',\n              pointerEvents: 'none',\n            }}>\n            <CutOutIcon sx={{ height: '4em' }}/>\n            <p sx={{ my: 3 }}>{ t('review-part-will-be-removed') }</p>\n          </div>\n          }\n          <video\n            ref={videoRefs[index]}\n            key={index}\n            src={recording.url}\n            onLoadedData={event => {\n              // Force the browser to calculate the duration of the stream\n              // by seeking way past its end. *fingers crossed*\n              // We reset this later in an effect. (See above.)\n              // Also without setting the current time once initially,\n              // some browsers show a black video element instead of the first frame.\n              event.target.currentTime = Number.MAX_VALUE;\n              durationCalculationProgress[index].current = 'started';\n            }}\n            onTimeUpdate={durationsCalculated ? event => {\n              const currentTime = event.target.currentTime;\n              setOverlayVisible(isInCutRegion(currentTime));\n\n              onTimeUpdate(event);\n            } : event => {\n              if (!durationsCalculated) {\n                switch (durationCalculationProgress[index].current) {\n                  case 'started':\n                    event.target.currentTime = ALMOST_ZERO;\n                    durationCalculationProgress[index].current = 'done';\n                    break;\n                  case 'done':\n                    if (durationCalculationProgress.filter(\n                      p => p.current === 'done'\n                    ).length === recordings.length) {\n                      setDurationsCalculated(true);\n                    }\n                    break;\n                  default:\n                    // Appease the linter\n                    break;\n                }\n              }} // eslint-disable-line\n            }\n            preload=\"auto\" tabIndex={'-1'}\n            sx={{\n              width: '100%',\n              height: '100%',\n              backgroundColor: '#ccc',\n              outline: 'none'\n            }}\n          />\n        </div>\n      </GlobalHotKeys>\n    ),\n    dimensions: () => recording.dimensions,\n  }));\n\n  return <VideoBox gap={20}>{children}</VideoBox>;\n});\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport Steps from './steps';\n\nimport AudioSetup from './audio-setup';\nimport SaveCreation from './save-creation';\nimport VideoSetup from './video-setup';\nimport Recording from './recording';\nimport Review from './review';\n\nimport { isRecordingSupported } from '../../util';\n\n\nexport default function Wizard({ activeStep, updateActiveStep, userHasWebcam }) {\n  // If recording is not supported we don't even let the user start the wizard.\n  // A warning is shown already (in `warnings.js`).\n  if (!isRecordingSupported()) {\n    return null;\n  }\n\n  return (\n    <Steps activeStep={activeStep} updateActiveStep={updateActiveStep}>\n      <VideoSetup userHasWebcam={userHasWebcam} />\n      <AudioSetup />\n      <Recording />\n      <Review />\n      <SaveCreation />\n    </Steps>\n  );\n}\n","const languages = [\n  { short: 'en', long: 'English', rtl: false },\n  { short: 'de', long: 'Deutsch', rtl: false },\n  { short: 'nl', long: 'Dutch', rtl: false },\n  { short: 'el', long: 'Ελληνικά', rtl: false },\n  { short: 'es', long: 'Español', rtl: false },\n  { short: 'fa', long: 'Farsi', rtl: true },\n  { short: 'fr', long: 'Français', rtl: false },\n  { short: 'sl', long: 'Slovenščina', rtl: false },\n  { short: 'tr', long: 'Turkish', rtl: false },\n  { short: 'zh', long: '简体中文', rtl: false },\n];\n\nexport default languages;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Themed } from 'theme-ui';\nimport { Box } from '@theme-ui/components';\n\n\nexport const SettingsSection = ({ title, children }) => (\n  <Box\n    sx={{\n      '&:not(:last-child)': {\n        mb: 5\n      }\n    }}\n  >\n    <Themed.h2\n      sx={{\n        borderBottom: theme => `1px solid ${theme.colors.gray[2]}`,\n        pb: 1,\n        my: 3,\n        mx: 0\n      }}\n    >\n      {title}\n    </Themed.h2>\n    {children}\n  </Box>\n);\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\n\nimport { jsx } from 'theme-ui';\nimport { useTranslation } from 'react-i18next';\n\nimport languages from '../../languages';\nimport { SettingsSection } from './elements';\n\nconst LanguageSettings = () => {\n  const { i18n, t } = useTranslation();\n  // Keep the 2nd \"Language\" string untranslated\n  // (If Studio is set to some weird language, you still want to find the language section)\n  var lang_label = t('settings-language-label');\n  if (lang_label !== 'Language') {\n    lang_label += ' / Language';\n  }\n  return (\n    <SettingsSection title={t('settings-general-header')}>\n      <label\n        htmlFor=\"studio-lang\"\n        sx={{ variant: 'styles.label' }}\n      >\n        {lang_label}\n      </label>\n      <select\n        id=\"studio-lang\"\n        sx={{ variant: 'styles.select' }}\n        defaultValue={i18n.language}\n        onChange={e => i18n.changeLanguage(e.target.value)}\n      >\n        {languages.map(language => (\n          <option value={language.short} key={language.short}>\n            {language.long}\n          </option>\n        ))}\n      </select>\n\n    </SettingsSection>\n  );\n};\n\nexport default LanguageSettings;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCheckCircle, faCircleNotch, faExclamationCircle } from \"@fortawesome/free-solid-svg-icons\";\nimport useForm from 'react-hook-form';\nimport { Link, useLocation } from 'react-router-dom';\nimport { Box, Button } from '@theme-ui/components';\n\nimport { useState } from 'react';\n\nimport {\n  Opencast,\n  useOpencast,\n  STATE_LOGGED_IN,\n  STATE_NETWORK_ERROR,\n  STATE_RESPONSE_NOT_OK,\n  STATE_INVALID_RESPONSE,\n  STATE_INCORRECT_LOGIN,\n  STATE_CONNECTED,\n  STATE_UNCONFIGURED,\n} from '../../opencast';\nimport Notification from '../notification';\nimport { SettingsSection } from './elements';\nimport { Input } from '../elements';\nimport { useStudioState } from '../../studio-state';\n\nimport { GlobalHotKeys } from 'react-hotkeys';\nimport { otherShortcuts } from '../studio/keyboard-shortcuts/globalKeys';\n\n\nfunction OpencastSettings({ settingsManager }) {\n  const location = useLocation();\n  const { t } = useTranslation();\n  const opencast = useOpencast();\n  const [error, setError] = useState();\n  const { errors, handleSubmit, register } = useForm({\n    defaultValues: settingsManager.formValues().opencast\n  });\n  const [status, setStatus] = useState('initial');\n\n  const { recordings } = useStudioState();\n  const hasRecording = recordings.length > 0;\n\n  async function onSubmit(data) {\n    setStatus('testing');\n    const oc = await Opencast.init({\n      ...settingsManager.settings().opencast,\n      ...data,\n    });\n\n    switch (oc.getState()) {\n      case STATE_LOGGED_IN:\n        opencast.setGlobalInstance(oc);\n        settingsManager.saveSettings({ opencast: data });\n        setStatus('saved');\n        setError(null);\n        break;\n\n      case STATE_NETWORK_ERROR:\n        setStatus('error');\n        setError(t('upload-settings-error-server-unreachable'));\n        break;\n      case STATE_RESPONSE_NOT_OK:\n        setStatus('error');\n        setError(t('upload-settings-error-response-not-ok'));\n        break;\n      case STATE_INVALID_RESPONSE:\n        setStatus('error');\n        setError(t('upload-settings-error-invalid-response'));\n        break;\n      case STATE_INCORRECT_LOGIN:\n        setStatus('error');\n        if (opencast.isLoginProvided()) {\n          setError(t('upload-settings-invalid-provided-login'));\n        } else {\n          setError(t('upload-settings-invalid-login-data'));\n        }\n        break;\n\n      case STATE_CONNECTED:    // <- login data is provided in some way -> state impossible\n      case STATE_UNCONFIGURED: // <- server URL is required -> state impossible\n      default:\n        console.error(\"bug: invalid state reached...\");\n        setStatus('error');\n        setError('internal error :(');\n    }\n  }\n\n  const showServerUrl = settingsManager.isConfigurable('opencast.serverUrl');\n  const showUsername = settingsManager.isUsernameConfigurable();\n  const showPassword = settingsManager.isPasswordConfigurable();\n\n  // If all settings are already specified by the context, we do not show\n  // anything at all.\n  if (!showServerUrl && !showUsername && !showPassword) {\n    return null;\n  }\n\n  const icons = {\n    testing: faCircleNotch,\n    error: faExclamationCircle,\n    saved: faCheckCircle,\n  };\n  const icon = icons[status];\n\n  const handlers = {\n    NEXT_BUTTON: keyEvent => { if(keyEvent) { handleSubmit(onSubmit(keyEvent)); } }\n  };\n\n  return (\n    <GlobalHotKeys keyMap={otherShortcuts} handlers={handlers}>\n      <SettingsSection title={t('upload-settings-modal-header')}>\n        <Box>\n          { error && <Notification isDanger>{error}</Notification> }\n\n          <form onSubmit={handleSubmit(onSubmit)}>\n            { showServerUrl && <Input\n              errors={errors}\n              label={t('upload-settings-label-server-url')}\n              name=\"serverUrl\"\n              register={register}\n              validate={value => {\n                try {\n                  const url = new URL(value);\n                  return (url.protocol === 'https:' || url.protocol === 'http:')\n                    || t('upload-settings-invalid-url-http-start');\n                } catch (e) {\n                  let err = t('upload-settings-invalid-url');\n                  if (!value.startsWith('https://') && !value.startsWith('http://')) {\n                    err += \" \" + t('upload-settings-invalid-url-http-start');\n                  }\n                  return err;\n                }\n              }}\n              required\n            /> }\n\n            { showUsername && <Input\n              errors={errors}\n              label={t('upload-settings-label-username')}\n              name=\"loginName\"\n              register={register}\n              required\n            /> }\n\n            { showPassword && <Input\n              errors={errors}\n              label={t('upload-settings-label-password')}\n              name=\"loginPassword\"\n              register={register}\n              required\n              type=\"password\"\n            /> }\n\n            <footer sx={{ mt: 4 }}>\n              <Button sx={{ verticalAlign: 'middle' }}>\n                {t('upload-settings-button-store')}\n              </Button>\n              { icon && <FontAwesomeIcon\n                icon={icon}\n                sx={{ ml: '10px', fontSize: '30px', verticalAlign: 'middle' }}\n                spin={status === 'testing'}\n              /> }\n              { hasRecording && status === 'saved' && (\n                <Link\n                  to={{ pathname: \"/\", search: location.search }}\n                  sx={{ ml: 3, variant: 'styles.a' }}\n                >\n                  {t('settings-back-to-recording')}\n                </Link>\n              )}\n            </footer>\n          </form>\n        </Box>\n      </SettingsSection>\n    </GlobalHotKeys>\n  );\n}\n\nexport default OpencastSettings;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, useColorMode } from 'theme-ui';\nimport { useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { SettingsSection } from './elements';\n\nconst ColorModeSettings = () => {\n  const { t } = useTranslation();\n  const [, setColorMode] = useColorMode();\n\n  const getSystemPreference = () => {\n    const isDarkPrefered = window.matchMedia('(prefers-color-scheme: dark)');\n    if(isDarkPrefered.matches) {\n      setColorMode('dark');\n    } else {\n      setColorMode('light');\n    }\n  };\n\n  useEffect(() => {\n    const theme = localStorage.getItem('theme');\n    if(theme === 'systemTheme') {\n      getSystemPreference();\n    }\n  });\n\n  const switchTheme = value => {\n    localStorage.removeItem('prefers-color-scheme');\n    if(value === 'systemTheme') {\n      getSystemPreference();\n      localStorage.setItem('theme', 'systemTheme');\n    } else if(value === 'darkTheme') {\n      setColorMode('dark');\n      localStorage.setItem('theme', 'darkTheme');\n    } else {\n      setColorMode('light');\n      localStorage.setItem('theme', 'lightTheme');\n    }\n  };\n\n  const themes = [\n    { value: 'systemTheme', label: t('settings-theme-system') },\n    { value: 'lightTheme', label: t('settings-theme-light') },\n    { value: 'darkTheme', label: t('settings-theme-dark') }\n  ];\n\n  return (\n    <SettingsSection title={t('settings-theme-appearance')}>\n      <select\n        sx={{ variant: 'styles.select' }}\n        defaultValue={localStorage.getItem('theme')}\n        onChange={themes => switchTheme(themes.target.value)}\n      >\n        {themes.map((option, index) => (\n          <option key={index} value={option.value}>{option.label}</option>\n        ))}\n      </select>\n    </SettingsSection>\n  );\n};\n\nexport default ColorModeSettings;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Themed } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { Box } from '@theme-ui/components';\n\nimport LanguageSettings from './language';\nimport OpencastSettings from './opencast';\nimport ColorModeSettings from './colorMode';\n\n\nconst SettingsPage = ({ settingsManager }) => {\n  const { t } = useTranslation();\n\n  return (\n    <Box sx={{ width: '100%', maxWidth: 960, mx: 'auto', p: 3 }}>\n      <header>\n        <Themed.h1 sx={{ mb: '1.5em' }}>{t('settings-header')}</Themed.h1>\n      </header>\n      <ColorModeSettings />\n      <LanguageSettings />\n      <OpencastSettings settingsManager={settingsManager} />\n    </Box>\n  );\n};\n\nexport default SettingsPage;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { useTranslation } from 'react-i18next';\n\nimport Notification from './notification';\nimport {\n  onSafari,\n  isRecordingSupported,\n} from '../util';\n\n// Conditionally shows a number of warnings to help the user identify problems.\nconst Warnings = () => {\n  const { t } = useTranslation();\n\n  let warnings = [];\n\n  // We allow HTTP connections to localhost, as most browsers also seem to allow\n  // video capture in those cases.\n  const usingUnsecureConnection = window.location.protocol !== 'https:' &&\n    window.location.hostname !== 'localhost' &&\n    window.location.hostname !== '127.0.0.1';\n  if (usingUnsecureConnection) {\n    warnings.push(\n      <Notification key=\"unsecure-connection\" isDanger>{t('warning-https')}</Notification>\n    );\n  }\n\n  // Warning about missing `MediaRecorder` support\n  if (!isRecordingSupported()) {\n    warnings.push(\n      <Notification key=\"media-recorder\" isDanger>\n        {t('warning-recorder-not-supported')}\n        {onSafari() && ' ' + t('warning-recorder-safari-hint')}\n      </Notification>\n    );\n  }\n\n\n  return warnings.length > 0\n    ? <div sx={{ p: 3 }}>{ warnings }</div>\n    : null;\n};\n\nexport default Warnings;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { useTranslation } from 'react-i18next';\nimport { getShortcuts } from './globalKeys';\n\nconst Group = ({ name, entries }) => {\n  const { t } = useTranslation();\n\n  return (\n    <div sx={{\n      margin: '10px',\n      display: 'flex',\n      flexDirection: 'column',\n      '@media screen and (max-width: 350px)': {\n        width: '300px',\n      }\n    }}>\n      <h3 sx={{\n        borderBottom: theme => `1px solid ${theme.colors.gray[1]}`,\n        textAlign: 'center',\n      }}>\n        {t(name)}\n      </h3>\n      { entries.map((entry, index) => (\n        <Entry params={entry} key={index}></Entry>\n      ))}\n    </div>\n  );\n};\n\nconst Entry = ({ params }) => {\n  const { t } = useTranslation();\n\n  return (\n    <div sx={{\n      display: 'flex',\n      flexDirection: 'row',\n      padding: '6px 0',\n      alignItems: 'center'\n    }}>\n\n      <div sx={{\n        width: '40%',\n        wordWrap: 'break-word',\n      }}>\n        {t(params.name)}\n      </div>\n      { params.description.map((description, index, arr) => (\n        <div key={index}\n          sx={{\n            padding: '2px 0',\n            display: 'flex',\n          }}>\n          { description.toString().split('+').map((singleKey, index) => (\n            <div key={index}\n              sx={{\n                borderRadius: '5px',\n                border: theme => `2px solid ${theme.colors.singleKey_border}`,\n                background: theme => theme.colors.singleKey_bg,\n                padding: '8px',\n                margin: '0 3px',\n                textAlign: 'center',\n                minWidth: '40px',\n              }}>\n              {t(singleKey)}\n            </div>\n          ))}\n          <div sx={{ alignSelf: 'center', lineHeight: '32px', margin: '0 5px' }}>\n            { arr.length - 1 !== index && t(\"sequence-seperator\") }\n          </div>\n        </div>\n      ))}\n\n    </div>\n  );\n};\n\nconst KeyboardShortcuts = () => {\n  const { t } = useTranslation();\n  const shortcuts = getShortcuts();\n\n  let obj = {};\n\n  if (shortcuts && Object.keys(shortcuts).length > 0) {\n    // Sort by group\n    for (const value of Object.values(shortcuts)) {\n      const key = value.group ?? t(\"other-shortcuts\");\n      if (!(key in obj)) {\n        obj[key] = [];\n      }\n      obj[key].push(value);\n    }\n  }\n\n  const groups = Object.entries(obj)\n    .filter(([_, value]) => value.length > 0)\n    .map(([key, value]) => <Group name={key} key={key} entries={value} />);\n\n  return (\n    <div sx={{\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      alignSelf: 'center',\n      width: '100%',\n    }}>\n      <h2 sx={{\n        display: 'block',\n        position: 'relative',\n        textAlign: 'center',\n      }}>\n        {t('nav-shortcuts')}\n      </h2>\n\n      <div sx={{\n        display: 'flex',\n        flexDirection: 'row',\n        flexWrap: 'wrap',\n        justifyContent: 'center',\n      }}>\n        { groups }\n      </div>\n\n    </div>\n  );\n};\n\nexport default KeyboardShortcuts;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { Flex } from '@theme-ui/components';\nimport { useState, Fragment } from 'react';\nimport { BrowserRouter as Router, Switch, Redirect, Route, useLocation } from 'react-router-dom';\nimport { Beforeunload } from 'react-beforeunload';\nimport { Global } from '@emotion/core';\nimport { useSettings } from './settings';\n\nimport { Provider, useStudioState, STATE_UPLOADED, STATE_UPLOADING } from './studio-state';\n\nimport About from './ui/about';\nimport Header from './ui/header';\nimport Studio from './ui/studio/page';\nimport SettingsPage from './ui/settings/page';\nimport Warnings from './ui/warnings';\nimport KeyboardShortcuts from './ui/studio/keyboard-shortcuts/shortcuts';\n\nfunction App({ settingsManager, userHasWebcam }) {\n  const settings = useSettings();\n\n  return (\n    <Router basename={process.env.PUBLIC_URL || '/'}>\n      <Global styles={settings.theme?.customCSS || ''}/>\n      <Provider>\n        <Flex sx={{ flexDirection: 'column', height: '100%' }}>\n          <Header />\n          <main sx={{ flex: 1, display: 'flex', flexDirection: 'column', minHeight: '285px' }}>\n            <Warnings />\n            <Routes settingsManager={settingsManager} userHasWebcam={userHasWebcam} />\n          </main>\n        </Flex>\n      </Provider>\n    </Router>\n  );\n}\n\nconst Routes = ({ settingsManager, userHasWebcam }) => {\n  const [activeStep, updateActiveStep] = useState(0);\n  const location = useLocation();\n\n  return (\n    <Fragment>\n      <PreventClose />\n      <Switch>\n        <Route path=\"/settings\" exact>\n          <SettingsPage settingsManager={settingsManager} />\n        </Route>\n        <Route path=\"/shortcuts\" exact>\n          <KeyboardShortcuts />\n        </Route>\n        <Route path=\"/about\" exact>\n          <About />\n        </Route>\n\n        <Route path=\"/\" exact>\n          <Studio\n            activeStep={activeStep}\n            updateActiveStep={updateActiveStep}\n            userHasWebcam={userHasWebcam}\n          />\n        </Route>\n\n        <Route path=\"/*\">\n          <Redirect to={{ pathname: \"/\", search: location.search }} />\n        </Route>\n      </Switch>\n    </Fragment>\n  );\n};\n\nconst PreventClose = () => {\n  const { recordings, upload } = useStudioState();\n  const downloaded = recordings.every(rec => rec.downloaded);\n  const uploaded = upload.state === STATE_UPLOADED;\n  const uploading = upload.state === STATE_UPLOADING;\n\n  const handler = event => {\n    if ((recordings?.length > 0 && !uploaded && !downloaded) || uploading) {\n      event.preventDefault();\n    }\n  };\n\n  return <Beforeunload onBeforeunload={handler} />;\n};\n\n\nexport default App;\n"],"sourceRoot":""}